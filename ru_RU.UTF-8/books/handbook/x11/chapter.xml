<?xml version="1.0" encoding="utf-8"?>
<!--
     The FreeBSD Russian Documentation Project

     $FreeBSD: head/ru_RU.KOI8-R/books/handbook/x11/chapter.xml 48458 2016-03-23 10:47:11Z amdmi3 $
     $FreeBSDru: frdp/doc/ru_RU.KOI8-R/books/handbook/x11/chapter.xml,v 1.68 2008/05/13 13:46:29 den Exp $

     Original revision: r47566
     Synced with Russian version (SVN 52803) from official repository
-->
<chapter xmlns="http://docbook.org/ns/docbook"
  xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0"
  xml:id="x11">

  <!--
  <chapterinfo> 
    <authorgroup>
      <author>
        <personname>
          <firstname>Ken</firstname>
          <surname>Tom</surname>
        </personname>

        <contrib>Обновили для сервера X.Org X11 </contrib>
      </author>

      <author>
        <personname>
          <firstname>Marc</firstname>
          <surname>Fonvieille</surname>
        </personname>
      </author>
    </authorgroup>
  </chapterinfo> 
  -->

  <title>X Window System</title>

  <sect1 xml:id="x11-synopsis">
    <title>Обзор</title>

    <para>Процедура установки &os; при помощи
      <application>bsdinstall</application> не предусматривает автоматической
      установки графического пользовательского интерфейса.  Эта глава
      описывает процесс установки и настройки пакета
      <application>&xorg;</application>, предоставляющий X Window System с
      открытым кодом, обеспечивающий графическую среду работы.  Затем она
      объясняет, как найти и установить оболочку рабочего стола или оконный
      менеджер.</para>

    <note>
      <para>Пользователи, предпочитающие метод установки, при котором
        <application>&xorg;</application> настраивается автоматически и
        предлагаются варианты выбора оконных менеджеров, должно обратить
        внимание на web-сайт <link
        xlink:href="http://www.pcbsd.org/">pcbsd.org</link>.</para>
    </note>

    <para>Для получения дополнительной информации об оборудовании, которое
      поддерживается в <application>&xorg;</application>, обратитесь к
      web-сайту <link xlink:href="http://www.x.org/">x.org</link>.</para>

    <para>После чтения этой главы вы будете знать:</para>

    <itemizedlist>
      <listitem>
	<para>О различных компонентах X Window System и их
	  взаимодействии.</para>
      </listitem>

      <listitem>
	<para>Как установить и настроить
          <application>&xorg;</application>.</para>
      </listitem>

      <listitem>
	<para>Как установить и настроить несколько оконных менеджеров и
          оболочек рабочего стола.</para>
      </listitem>

      <listitem>
	<para>Как использовать шрифты &truetype; в
          <application>&xorg;</application>.</para>
      </listitem>

      <listitem>
	<para>Как настроить вашу систему на графический интерфейс входа
	  (<application>XDM</application>).</para>
      </listitem>
    </itemizedlist>

    <para>Перед чтением этой главы вам требуется:</para>

    <itemizedlist>
      <listitem>
	<para>Знать, как устанавливать дополнительное программное обеспечение
	  сторонних разработчиков в соответствии с описанием в <xref
          linkend="ports"/>.</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="x-understanding">
    <title>Терминология</title>

    <para>Хотя нет необходимости вникать во все тонкости различных компонент
      X Window System и взаимодействия между ними, некоторые базовые знания
      об этих компонентах могут быть полезными.</para>

    <variablelist>
      <varlistentry>
        <term>X-сервер</term>

        <listitem>
          <para>X изначально разрабатывалась, чтобы быть системой,
            ориентированной на работу в сети, и использует модель
	    <quote>клиент-сервер</quote>.  В этой модели
            <quote>X-сервер</quote> работает на компьютере с
	    клавиатурой, монитором и мышью.  Область ответственности сервера
	    включает управление дисплеем, обработку ввода с клавиатуры и мыши,
            а также обработку ввода и вывода с других устройств, таких, как
            планшет или видеопроектор.  Некоторых это запутывает, потому что
            терминология X в точности противоположна тому, что они ожидают.
            Они полагают, что <quote>X-сервером</quote> будет являться большая
            мощная машина в конце коридора, а <quote>X-клиентом</quote>
            выступает компьютер на их рабочем столе.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>X-клиент</term>

        <listitem>
          <para>Каждое X-приложение, такое, как
            <application>XTerm</application> или
            <application>Firefox</application>, является
	    <quote>клиентом</quote>.  Клиент посылает сообщения серверу,
            такие, как <quote>Пожалуйста, нарисуй окно со следующими
            координатами</quote>, а сервер посылает в ответ сообщения
            типа <quote>Пользователь только что щёлкнул мышью на кнопке
            OK</quote>.</para>

          <para>При использовании дома или в офисе, сервер и клиенты X, как
            правило, работают на том же самом компьютере.  Однако можно также
            запустить X-сервер на более слабом компьютере, а приложения X
            запускать на более мощной системе.  При таком сценарии коммуникации
            между X-клиентом и сервером осуществляются по сети.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>оконный менеджер</term>

        <listitem>
          <para>X не определяется, как окна должны выглядеть на экране, как их
            двигать мышью, какие комбинации клавиш должны использоваться для
            переключения между окнами, как должны выглядеть заголовки окон,
            должны ли в них быть кнопки для закрытия и так далее.  Вместо
            этого X делегирует ответственность за это отдельному приложению
            управления окнами.  Существуют <link
            xlink:href="http://xwinman.org/">десятки оконных менеджеров</link>.
            Каждый оконный менеджер реализует собственный внешний вид и подход
            к управлению: некоторые поддерживают виртуальные рабочие столы,
            некоторые позволяют изменять назначения комбинаций клавиш для
            управления рабочим окружением, в некоторых есть кнопка
            <quote>Start</quote>, а некоторые поддерживают
            <quote>темы</quote>, позволяя полностью менять образ
            рабочего окружения.  Оконные менеджеры находятся в категории
            <filename>x11-wm</filename> Коллекции Портов.</para>

          <para>Каждый оконный менеджер использует собственный механизм
            настройки.  Некоторые предполагают наличие вручную созданного
            конфигурационного файла, тогда как другие предоставляют
            графические инструменты для выполнения большинства задач по
            настройке.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>оболочки рабочего стола</term>

        <listitem>
          <para><application>KDE</application> и
            <application>GNOME</application>, рассматриваются как оболочки
            для организации рабочего стола, так как они включают в себя полный
            набор приложений для выполнения повседневной работы.  Сюда могут
            входить офисные пакеты, web-браузеры и игры.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>политика фокусирования</term>

        <listitem>
          <para>Менеджер окон отвечает за политику фокусирования мыши.  Эта
            политика предоставляет некоторый механизм, который определяет,
            какое окно активно обрабатывает нажатия клавиш, а также визуально
            отображает, какое окно является в настоящий момент активным.</para>

          <para>Одна из политик фокусирования называется
            <quote>фокусирование по щелчку</quote>.  В такой модели окно
            становится активным после получения щелчка мыши.  В политике
            <quote>фокус следует за мышью</quote> фокус получает окно,
            находящееся под указателем мыши, и этот фокус меняется при
            указании на другое окно.  Если мышь находится поверх корневого
            окна, то фокусирование производится на этом окне.  В модели
            <quote>нечёткого фокусирования</quote> при перемещении мыши на
            корневое окно фокус остаётся на последнем используемом окне.
            При нечётком фокусовании фокус меняется только при перемещении
            курсора на новое окно, и не меняется при выходе из текущего окна.
            В политике <quote>фокусирования по щелчку</quote> активное окно
            выбирается щелчком мыши.  Затем это окно может быть вызвано и
            появиться поверх всех других окон.  Все нажатия клавиш
            при этом будут направляться в это окно, даже если указатель
            переместился на другое окно.</para>

          <para>Разные оконные менеджеры поддерживают разные модели
            фокусирования.  Все они поддерживают фокусирование по щелчку, и
            большинство также поддерживает другие политики.  Обратитесь к
            документации по оконному менеджеру для выяснения доступности
            моделей фокусирования.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>виджеты</term>

        <listitem>
          <para>Виджет - это термин, употребляемый для любых объектов
            пользовательского интерфейса, на которые можно щёлкать или которыми
            можно манипулировать каким-либо образом.  Сюда включаются кнопки,
            зависимые и независимые опции, иконки и списки.  Библиотека
            виджетов представляет собой набор виджетов, используемых для
            создания графических приложений.  Существует несколько популярных
            библиотек виджетов, среди которых Qt, используемый в
            <application>KDE</application>, и GTK+, применяемый в
            <application>GNOME</application>.  В результате приложения будут
            иметь разный внешний вид в зависимости от того, какая библиотека
            использовалась для создания приложения.</para>
        </listitem>
      </varlistentry>
    </variablelist>
  </sect1>

  <sect1 xml:id="x-install">
    <title>Установка <application>&xorg;</application></title>

    <para>Во &os; <application>&xorg;</application> может быть установлен как
      пакет или как порт.</para>

    <para>Для построения и установки из Коллекции портов выполните следующие
      команды:</para>

    <screen>&prompt.root; <userinput>cd /usr/ports/x11/xorg</userinput>
&prompt.root; <userinput>make install clean</userinput></screen>

    <para>Откомпилированный пакет может быть установлен быстрее, но он даёт
      меньше опций для настройки:</para>

    <screen>&prompt.root; <userinput>pkg install xorg</userinput></screen>

    <para>Любой из этих методов приводит к установке полной системы
      <application>&xorg;</application> и является наилучшим подходом для
      большинства пользователей.</para>

    <para>Более компактная версия X, подходящая для опытных пользователей,
      доступна в пакете <package>x11/xorg-minimal</package>.  При его выборе
      подавляющее большинство документов, библиотек и приложений не будут
      устаналиваться.  Некоторым приложениям для работы требуются эти
      дополнительные компоненты.</para>
  </sect1>

  <sect1 xml:id="x-config">
    <title>Настройка <application>&xorg;</application></title>

    <info>
      <author>
        <personname>
          <firstname>Warren</firstname>
          <surname>Block</surname>
        </personname>
        <contrib>Оригинальный текст предоставил</contrib>
      </author>
    </info>

    <indexterm><primary>&xorg;</primary></indexterm>
    <indexterm><primary><application>&xorg;</application></primary></indexterm>

    <sect2 xml:id="x-config-quick-start">
      <title>Быстрый запуск</title>

      <para><application>&xorg;</application> поддерживает большинство
        распространённых графических адаптеров, клавиатур и устройств
        позиционирования.  Эти устройства распознаются автоматически и не
        требуют ручной настройки.</para>

      <procedure>
        <step>
          <para>Если <application>&xorg;</application> использовалась ранее на
            этом компьютере, перенесите или удалите все существующие
            конфигурационные файлы:</para>

          <screen>&prompt.root; <userinput>mv /etc/X11/xorg.conf ~/xorg.conf.etc</userinput>
&prompt.root; <userinput>mv /usr/local/etc/X11/xorg.conf ~/xorg.conf.localetc</userinput></screen>
        </step>

        <step>
          <para>Добавьте пользователя, который будет запускать
            <application>&xorg;</application>, к группе
            <literal>video</literal> или
            <literal>wheel</literal> для обеспечения возможности использования
            3D-ускорения при его доступности. Чтобы добавить пользователя
            <replaceable>jru</replaceable> к одной из указанных групп
            выполните следующую команду:</para>

          <screen>&prompt.root; <userinput>pw groupmod video -m <replaceable>jru</replaceable> || pw groupmod wheel -m <replaceable>jru</replaceable></userinput></screen>
        </step>

        <step>
          <para>По умолчанию в поставку включён оконный менеджер
            <acronym>TWM</acronym>.  Он запускается вместе с запуском
            <application>&xorg;</application> следующей командой:</para>

          <screen>&prompt.user; <userinput>startx</userinput></screen>
        </step>

        <step>
          <para>В некоторых более старых версиях &os; для того, чтобы обратное
            переключение в текстовый режим работало корректно, в качестве
            системной консоли должно использоваться устройство &man.vt.4;.
            Для получения более полной информации обратитесь к разделу <xref
            linkend="x-config-kms"/>.</para>
        </step>
      </procedure>
    </sect2>

    <sect2 xml:id="x-config-user-group">
      <title>Пользовательская группа для графики с ускорением</title>

      <para>Для включения 3D-ускорения на графических адаптерах необходим
        доступ к устройству <filename>/dev/dri</filename>.  Как правило, проще
        всего добавить пользователя, который будет запускать X, в группу
        <literal>video</literal> или <literal>wheel</literal>.  Для включения
        пользователя <replaceable>slurms</replaceable> в группу
        <literal>video</literal> или в группу <literal>wheel</literal> в случае
        отсутствия группы <literal>video</literal> в команде ниже используется
        &man.pw.8;:</para>

      <screen>&prompt.root; <userinput>pw groupmod video -m <replaceable>slurms</replaceable> || pw groupmod wheel -m <replaceable>slurms</replaceable></userinput></screen>
    </sect2>

    <sect2 xml:id="x-config-kms">
      <title>Настройка режима ядра (<acronym>KMS</acronym>)</title>

      <para>Когда компьютер переключает консоль в режим более высокого
        разрешения для работы X, он должен задать <emphasis>режим</emphasis>
        выдачи видео.  Последние версии <acronym>&xorg;</acronym> используют
        систему внутри ядра для переключения этих режимов более эффективно.
        Более старые версии &os; используют устройство &man.sc.4;, которое не
        работает с <acronym>KMS</acronym>.  В итоге после закрытия сеанса X
        системная консоль пуста, хотя продолжает функционировать.  Более новое
        консольное устройство &man.vt.4; не имеет этой проблемы.</para>

      <para>Для активации &man.vt.4; добавьте в файл
        <filename>/boot/loader.conf</filename> следующую строку:</para>

      <programlisting>kern.vty=vt</programlisting>
    </sect2>

    <sect2 xml:id="x-config-files">
      <title>Конфигурационные файлы</title>

      <sect3 xml:id="x-config-files-directory">
        <title>Каталог</title>

        <para><application>&xorg;</application> использует несколько каталогов
          для размещения конфигурационных файлов.  Для &os; каталог
          <filename>/usr/local/etc/X11/</filename> является рекомендованным
          для таких файлов.  Использование этого каталога помогает размещать
          файлы прикладной системы отдельно от файлов операционной
          системы.</para>

        <para>Размещение конфигурационных файлов в когда-то традиционном
          каталоге <filename>/etc/X11/</filename> всё ещё поддерживается.
          Однако это приводит к смешиванию файлов прикладной системы со
          стандартными файлами &os;, что не рекомендуется.</para>
      </sect3>

      <sect3 xml:id="x-config-files-single-or-multi">
        <title>Один файл или несколько</title>

        <para>Использовать несколько файлов вместо традиционно единственного
          <filename>xorg.conf</filename> легче, так как каждый из них
          содержит специфичные настройки.  Эти файлы рахмещаются в подкаталоге
          <filename>xorg.conf.d/</filename> основного каталога, содержащего
          конфигурационные файлы.  Полный маршрут обычно выглядит как
          <filename>/usr/local/etc/X11/xorg.conf.d/</filename>.</para>

        <para>Примеры таких файлов приведены в этом разделе ниже.</para>

        <para>Использование традиционного единого файла
          <filename>xorg.conf</filename> также поддерживается, но это не так
          гибко и не так прозрачно, как использование нескольких файлов в
          подкаталоге <filename>xorg.conf.d/</filename>.</para>
      </sect3>
    </sect2>

    <sect2 xml:id="x-config-video-cards">
      <title>Графические адаптеры</title>

      <variablelist>
        <varlistentry xml:id="x-config-video-cards-intel">
          <term>&intel;</term>

          <listitem>
            <para>Ускорение 3D-графики поддерживается для большинства
              графических адаптеров &intel;, включая IronLake, SandyBridge и
              IvyBridge.</para>
          </listitem>
        </varlistentry>

        <varlistentry xml:id="x-config-video-cards-radeon">
          <term>&amd; Radeon</term>

          <listitem>
            <para>Ускорение 2D и 3D поддерживается для адаптеров Radeon вплоть
              до и включая линейку HD6000.</para>
          </listitem>
        </varlistentry>

        <varlistentry xml:id="x-config-video-cards-nvidia">
          <term>NVIDIA</term>

          <listitem>
            <para>В категории <filename>x11</filename> Коллекции Портов
              доступно несколько драйверов NVIDIA.  Установите драйвер,
              соответствующий графическому адаптеру.</para>
          </listitem>
        </varlistentry>

        <varlistentry xml:id="x-config-video-cards-hybrid">
          <term>Смешанные комбинации графических адаптеров</term>

          <listitem>
            <para> В некоторые ноутбуки добавляют дополнительные модули
              обработки графики дополнительно к тем, что встроены в набор
              микросхем или процессор.  <emphasis>Optimus</emphasis>
              комбинирует оборудование &intel; и NVIDIA.
	      <emphasis>Переключаемая графика</emphasis> или 
              <emphasis>Гибридная графика</emphasis> являются комбинацией
              <acronym>GPU</acronym> от &intel; и &amd; Radeon.</para>

            <para>Реализации подобных гибридных графических систем
              разнообразны, и <application>&xorg;</application> во &os; не
              имеет возможности отслеживать все их варианты.</para>

            <para>Некоторые компьютеры имеют возможность отключить один из
              графических адаптеров в <acronym>BIOS</acronym> или выбрать режим
              <emphasis>discrete</emphasis>, который может быть использован
	      в комбинации с одним из стандартных драйверов видеокарт.  К
              примеру, иногда возможно отключить <acronym>GPU</acronym> от
              NVIDIA в системе Optimus.  В таком случае возможно использовать
              адаптер &intel; вместе с драйвером от &intel;.</para>

            <para>Настройки <acronym>BIOS</acronym> зависят от модели
              компьютера.</para>
          </listitem>
        </varlistentry>

        <varlistentry xml:id="x-config-video-cards-other">
          <term>Прочие видеокарты</term>

          <listitem>
            <para>В каталоге <filename>x11-drivers</filename> Коллекции Портов
              можно найти драйверы для некоторых реже встречающихся графических
              адаптеров.</para>

            <para>Адаптеры, которые не поддерживаются специализированным
              драйвером, всё же могут использоваться совместно с драйвером
              <package>x11-drivers/xf86-video-vesa</package>.  Этот драйвер
	      устанавливается вместе с пакетом <package>x11/xorg</package>.
	      Также его можно установить в ручном режиме как пакет
              <package>x11-drivers/xf86-video-vesa</package>.
              <application>&xorg;</application> пытается использовать этот
              драйвер в тех случаях, когда для установленного графического
              адаптера специализированный драйвер не может быть найден.</para>

            <para><package>x11-drivers/xf86-video-scfb</package> представляет
              собой подобный неспециализированный драйвер видео, работающий со
              многими компьютерами <acronym>UEFI</acronym> и &arm;.</para>
          </listitem>
        </varlistentry>
      </variablelist>
    </sect2>

    <sect2 xml:id="x-config-monitors">
      <title>Мониторы</title>

      <para>Практически все мониторы поддерживают стандарт Extended Display
        Identification Data (<acronym>EDID</acronym>).
        <application>&xorg;</application> использует <acronym>EDID</acronym>
        для работы с монитором и выявления поддерживаемых разрешений и частот
        обновления.  Затем система выбирает комбинацию параметров, наиболее
        подходящую к использованию с данным монитором.</para>

      <para>Другие разрешения, поддерживаемые данным монитором, могут быть
        установлены указанием требуемого разрешения в конфигурационных файлах
        либо после запуска X-сервера при помощи &man.xrandr.1;.</para>

      <variablelist>
        <varlistentry xml:id="x-config-monitors-xrandr">
          <term>Использование &man.xrandr.1;</term>

          <listitem>
            <para>Запустите &man.xrandr.1; без каких-либо параметров, чтобы
	      посмотреть список устройств и выявленные режимы работы
	      мониторов:</para>

            <screen>&prompt.user; <userinput>xrandr</userinput>
Screen 0: minimum 320 x 200, current 3000 x 1920, maximum 8192 x 8192
DVI-0 connected primary 1920x1200+1080+0 (normal left inverted right x axis y axis) 495mm x 310mm
   1920x1200     59.95*+
   1600x1200     60.00
   1280x1024     85.02    75.02    60.02
   1280x960      60.00
   1152x864      75.00
   1024x768      85.00    75.08    70.07    60.00
   832x624       74.55
   800x600       75.00    60.32
   640x480       75.00    60.00
   720x400       70.08
DisplayPort-0 disconnected (normal left inverted right x axis y axis)
HDMI-0 disconnected (normal left inverted right x axis y axis)</screen>

            <para>Этот текст показывает, что устройство
              <literal>DVI-0</literal> используется для организации экрана
	      разрешением 1920x1200 точек с частотой обновления около 60 Гц.
	      К соединениям <literal>DisplayPort-0</literal> и
              <literal>HDMI-0</literal> мониторы не подключены.</para>

            <para>При помощи &man.xrandr.1; могут быть выбраны любые другие
	      режимы работы дисплея.  К примеру, для переключения в режим
	      1280x1024 на частоте 60 Гц запустите следующую команду:</para>

            <screen>&prompt.user; <userinput>xrandr --mode 1280x1024 --rate 60</userinput></screen>

            <para>Часто решаемой задачей является использование внешнего
	      видеовыхода на ноутбуке для подключения видеопроектора.</para>

            <para>Наименования и типы видеоконнекторов достаточно разнообразны,
	      поэтому &man.xrandr.1; запускается без параметров для показа
	      списка видеоустройств:</para>

            <screen>&prompt.user; <userinput>xrandr</userinput>
Screen 0: minimum 320 x 200, current 1366 x 768, maximum 8192 x 8192
LVDS1 connected 1366x768+0+0 (normal left inverted right x axis y axis) 344mm x 193mm
   1366x768      60.04*+
   1024x768      60.00
   800x600       60.32    56.25
   640x480       59.94
VGA1 connected (normal left inverted right x axis y axis)
   1280x1024     60.02 +  75.02
   1280x960      60.00
   1152x864      75.00
   1024x768      75.08    70.07    60.00
   832x624       74.55
   800x600       72.19    75.00    60.32    56.25
   640x480       75.00    72.81    66.67    60.00
   720x400       70.08
HDMI1 disconnected (normal left inverted right x axis y axis)
DP1 disconnected (normal left inverted right x axis y axis)</screen>

            <para>Было обнаружено четыре видеоустройства: встроенная панель
              <literal>LVDS1</literal> и внешние подключения
              <literal>VGA1</literal>, <literal>HDMI1</literal> и
              <literal>DP1</literal>.</para>

            <para>Проектор оказался подключенным к устройству
              <literal>VGA1</literal>.  Теперь используем &man.xrandr.1; для
	      приведения настроек этого устройства к стандартному разрешению
	      проектора и добавления дополнительного пространства к рабочему
	      столу справа:</para>

            <screen>&prompt.user; <userinput>xrandr --output VGA1 --auto --right-of LVDS1</userinput></screen>

            <para>Параметр <literal>--auto</literal> задаёт выбор разрешения и
	      частоты обновления, выявленному через <acronym>EDID</acronym>.
              Если разрешение определяется некорректно, вместо параметра
	      <literal>--auto</literal> при помощи опции
              <literal>--mode</literal> может быть задано фиксированное
              значение.  К примеру, большинство проекторов могут работать с
	      разрешением 1024x768, что задаётся параметром  
              <literal>--mode 1024x768</literal>.</para>

            <para>&man.xrandr.1; часто запускается из
	      <filename>.xinitrc</filename> для того, чтобы задать
	      подходящий режим при запуске X.</para>
          </listitem>
        </varlistentry>

        <varlistentry xml:id="x-config-monitors-files">
          <term>Настройка разрешения монитора в файле</term>

          <listitem>
            <para>Для того, чтобы задать разрешение 1024x768 в конфигурационном
	      файле:</para>

            <programlisting>Section "Screen"
       Identifier "Screen0"
       Device     "Card0"
       SubSection "Display"
               Modes "1024x768"
       EndSubSection
EndSection</programlisting>

            <para>То небольшое количество моделей мониторов, не поддерживающих
              <acronym>EDID</acronym>, могут быть настроены указанием
              параметров <literal>HorizSync</literal> и
              <literal>VertRefresh</literal> в границах частот, поддерживаемых
              монитором.</para>

            <example>
              <title>Ручная настройка частот монитора</title>

              <para><filename>/usr/local/etc/X11/xorg.conf.d/monitor0-freq.conf</filename></para>

              <programlisting>Section "Monitor"
        Identifier   "Monitor0"
        HorizSync    30-83   # kHz
        VertRefresh  50-76   # Hz
EndSection</programlisting>
            </example>
          </listitem>
        </varlistentry>
      </variablelist>
    </sect2>

    <sect2 xml:id="x-config-input">
      <title>Устройства ввода</title>

      <sect3 xml:id="x-config-input-keyboard">
        <title>Клавиатуры</title>

        <variablelist>
          <varlistentry xml:id="x-config-input-keyboard-layout">
            <term>Раскладка клавиатуры</term>

            <listitem>
              <para>Стандартизованное размещение клавиш на клавиатуре
	        называется раскладкой (<emphasis>layout</emphasis>).  Раскладки
	        и другие настраиваемые параметры перечислены в
                &man.xkeyboard-config.7;.</para>

              <para>По умолчанию применяется раскладка United States
	        (Соединённые Штаты).  Для выбора альтернативной раскладки
                задайте параметры <literal>XkbLayout</literal> и
                <literal>XkbVariant</literal> в <literal>InputClass</literal>.
	        Они будут применяться ко всем устройствам ввода этого
                класса.</para>

              <para>В данном примере выбирается раскладка клавиатуры French
                (французская) в варианте <literal>oss</literal>.</para>

              <example>
                <title>Установка раскладки клавиатуры</title>

                <para><filename>/usr/local/etc/X11/xorg.conf.d/keyboard-fr-oss.conf</filename></para>

                <programlisting>Section "InputClass"
       Identifier      "KeyboardDefaults"
       Driver          "keyboard"
       MatchIsKeyboard "on"
       Option          "XkbLayout" "fr"
       Option          "XkbVariant" "oss"
EndSection</programlisting>
              </example>
            </listitem>
          </varlistentry>

          <varlistentry xml:id="x-config-input-keyboard-zap">
            <term>Завершение работы <application>&xorg;</application> c
              клавиатуры</term>

            <listitem>
              <para>Для завершения работы системы X имеется определённая
	        комбинация клавиш.  Эта возможность по умолчанию отключена, так
		как она конфликтует с клавиатурными командами некоторых
		приложений.  Включение этой возможности требует внесения
		изменений как в раздел <literal>ServerLayout</literal>, так и
		клавиатурный <literal>InputDevice</literal>:</para>

              <example>
                <title>Активация завершения работы X с клавиатуры</title>

                <para><filename>/usr/local/etc/X11/xorg.conf.d/serverlayout-enablezap.conf</filename></para>

                <programlisting>Section "ServerLayout"
       Identifier "EnableZap"
       Option     "DontZap" "Off"
EndSection</programlisting>

                <para><filename>/usr/local/etc/X11/xorg.conf.d/keyboard-zap.conf</filename></para>

                <programlisting>Section "InputClass"
       Identifier      "KeyboardDefaults"
       Driver          "keyboard"
       MatchIsKeyboard "on"
       Option          "XkbOptions" "terminate:ctrl_alt_bksp"
EndSection</programlisting>
              </example>
            </listitem>
          </varlistentry>
        </variablelist>
      </sect3>

      <sect3 xml:id="x11-input-mice">
        <title>Мыши и устройства позиционирования</title>

        <para>Многие характеристики работы мыши могут быть изменены
          конфигурационными параметрами.  Для получения полного списка
	  обратитесь к &man.mousedrv.4x;.</para>

        <variablelist>
          <varlistentry xml:id="x11-input-mice-buttons">
            <term>Кнопки мыши</term>

            <listitem>
              <para>Количество кнопок мыши может быть задано в разделе
                <literal>InputDevice</literal> о мыши файла
                <filename>xorg.conf</filename>.  Для задания количества кнопок,
		равного 7:</para>

              <example>
                <title>Установка количества кнопок мыши</title>

                <para><filename>/usr/local/etc/X11/xorg.conf.d/mouse0-buttons.conf</filename></para>

                <programlisting>Section "InputDevice"
       Identifier  "Mouse0"
       Option      "Buttons" "7"
EndSection</programlisting>
              </example>
            </listitem>
          </varlistentry>
        </variablelist>
      </sect3>
    </sect2>

    <sect2 xml:id="x-config-manual-configuration">
      <title>Ручная настройка</title>

      <para>В некоторых случая функция автоматической настройки
	<application>&xorg;</application> не работает с определённым аппаратным
	обеспечением, либо имеется потребность в других настройках.  Для таких
	ситуаций может быть создан специальный конфигурационный файл.</para>

      <para>Файл с настройками может быть сгенерирован при помощи
        <application>&xorg;</application> на основании информации о выявленном
        оборудовании.  Этот файл зачастую оказывается полезной отправной точкой
	для специальных конфигураций.</para>

      <para>Генерация <filename>xorg.conf</filename>:</para>

      <screen>&prompt.root; <userinput>Xorg -configure</userinput></screen>

      <para>Конфигурационный файл сохраняется в
        <filename>/root/xorg.conf.new</filename>.  Внесите любые требуемые
	изменения, затем проверьте этот файл следующей командой:</para>

      <screen>&prompt.root; <userinput>Xorg -config /root/xorg.conf.new</userinput></screen>

      <para>После того, как новая конфигурация откорректирована и проверена,
	её можно разделить на файлы меньшего размера и разместить в обычном
	месте, <filename>/usr/local/etc/X11/xorg.conf.d/</filename>.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="x-fonts">
    <!--
    <sect1info>
      <authorgroup>
	<author>
          <personname>
            <firstname>Murray</firstname>
            <surname>Stokely</surname>
          </personname><contrib>Текст предоставил </contrib></author>
      </authorgroup>
    </sect1info>
    -->

    <title>Использование шрифтов в <application>&xorg;</application></title>

    <sect2 xml:id="type1">
      <title>Шрифты Type1</title>

      <para>Шрифты, используемые по умолчанию и распространяемые вместе с
	<application>&xorg;</application>, вряд ли можно назвать идеально
        подходящими для применения в
        обычных издательских приложениях.  Большие презентационные шрифты
        выглядят рвано и непрофессионально, а мелкие шрифты вообще невозможно
	разобрать.  Однако есть некоторое количество свободно распространяемых
	высококачественных шрифтов Type1 (&postscript;), которые можно без
	изменений использовать с <application>&xorg;</application>.  К примеру,
        в наборе шрифтов URW
	(<package>x11-fonts/urwfonts</package>) имеются
	высококачественные версии стандартных шрифтов type1 (<trademark
        class="registered">Times Roman</trademark>, <trademark
        class="registered">Helvetica</trademark>, <trademark
        class="registered">Palatino</trademark> и другие).  В набор Freefonts
	(<package>x11-fonts/freefonts</package>) включено ещё
	больше шрифтов, однако большинство из них предназначено для
	использования в программном обеспечении для работы с графикой,
	например, <application>Gimp</application>, и они не вполне пригодны
	для использования в качестве
	экранных шрифтов.  Кроме того, <application>&xorg;</application> с
	минимальными усилиями может быть настроена на использование шрифтов
	&truetype;. Более подробную информацию можно найи на странице
	справочной системы &man.X.7; или в <link linkend="truetype"/>.</para>

      <para>Для установки вышеупомянутых коллекций шрифтов Type1 из Коллекции
	Портов выполните следующие команды:</para>

      <screen>&prompt.root; <userinput>cd /usr/ports/x11-fonts/urwfonts</userinput>
&prompt.root; <userinput>make install clean</userinput></screen>

      <para>То же самое нужно будет сделать для коллекции freefont и других.
	Чтобы X-сервер обнаруживал
	этих шрифты, добавьте соответствующую строку в
	файл настройки X сервера (<filename>/etc/X11/xorg.conf</filename>),
	которая должна выглядеть так:</para>

      <programlisting>FontPath "/usr/local/share/fonts/urwfonts/"</programlisting>

      <para>Либо из командной строки при работе с X выполните:</para>

      <screen>&prompt.user; <userinput>xset fp+ /usr/local/share/fonts/urwfonts</userinput>
&prompt.user; <userinput>xset fp rehash</userinput></screen>

      <para>Это сработает, но будет потеряно, когда сеанс работы с X будет
	закрыт, если эта команда не будет добавлена в начальный файл
	(<filename>~/.xinitrc</filename> в случае обычного сеанса через
	<command>startx</command>
	или <filename>~/.xsession</filename> при входе через графический
	менеджер типа <application>XDM</application>).  Третий способ
	заключается в использовании нового файла
	<filename>/usr/local/etc/fonts/local.conf</filename>, как это показано
        в разделе <xref linkend="antialias"/>.</para>
    </sect2>

    <sect2 xml:id="truetype">
      <title>Шрифты &truetype;</title>

      <indexterm><primary>Шрифты TrueType</primary></indexterm>
      <indexterm>
	<primary>шрифты</primary>
	<secondary>TrueType</secondary>
      </indexterm>

      <para>В <application>&xorg;</application> имеется встроенная
	поддержка шрифтов &truetype;.  Имеются два модуля, которые могут
	обеспечить эту функциональность.  В нашем примере используется модуль
	freetype, потому что он в большей степени похож на другие механизмы
	для работы с шрифтами.  Для включения модуля freetype достаточно в
	раздел <literal>"Module"</literal> файла
	<filename>/etc/X11/xorg.conf</filename> добавить следующую
	строчку.</para>

      <programlisting>Load  "freetype"</programlisting>

      <para>Теперь создайте каталог для шрифтов &truetype;
	(к примеру, <filename>/usr/local/share/fonts/TrueType</filename>) и
	скопируйте все шрифты &truetype; в этот каталог.  Имейте в виду,
	что напрямую использовать шрифты &truetype; с &apple; &mac; нельзя;
	для использования с <application>&xorg;</application> они должны
	быть в формате &unix;/&ms-dos;/&windows;.  После того, как файлы будут
	скопированы в этот каталог, воспользуйтесь утилитой
	<application>ttmkfdir</application> для создания файла
	<filename>fonts.dir</filename>, который подскажет подсистеме вывода
	шрифтов X, что эти новые файлы были установлены.
        <command>ttmkfdir</command> присутствует в Коллекции Портов FreeBSD как
	<package>x11-fonts/ttmkfdir</package>.</para>

      <screen>&prompt.root; <userinput>cd /usr/local/share/fonts/TrueType</userinput>
&prompt.root; <userinput>ttmkfdir -o fonts.dir</userinput></screen>

      <para>Теперь добавьте каталог со шрифтами &truetype;
	к маршруту поиска шрифтов.  Это делается точно также, как описано в
        <xref linkend="type1"/>:</para>

      <screen>&prompt.user; <userinput>xset fp+ /usr/local/share/fonts/TrueType</userinput>
&prompt.user; <userinput>xset fp rehash</userinput></screen>

      <para>или добавьте строку <option>FontPath</option> в файл
	<filename>xorg.conf</filename>.</para>

      <para>Теперь <application>Gimp</application>,
	<application>OpenOffice</application> и все остальные приложения
        для X должны обнаружить установленные шрифты &truetype;.  Очень
        маленькие (как
	текст веб-страницы на дисплее с высоким разрешением) и очень большие (в
	<application>&staroffice;</application>) шрифты будут теперь выглядеть
	гораздо лучше.</para>
    </sect2>

    <sect2 xml:id="antialias">
      <!--
      <sect2info>
        <authorgroup>
	  <author>
            <personname>
              <firstname>Joe Marcus</firstname>
              <surname>Clarke</surname>
            </personname>

            <contrib>Обновление выполнил </contrib>
          </author>
        </authorgroup>
      </sect2info>
      -->

      <title>Шрифты с антиалиасингом</title>

      <indexterm>
	<primary>шрифты с антиалиасингом</primary>
      </indexterm>

      <indexterm>
	<primary>шрифты</primary>

	<secondary>антиалиасинг</secondary>
      </indexterm>

      <para>Все шрифты <application>&xorg;</application>, расположенные в
        каталогах <filename>/usr/local/share/fonts/</filename> и
	<filename>~/.fonts/</filename>, автоматически становятся доступными для
	применения антиалиасинга в приложениях, использующих Xft.
        Большинство современных приложений умеет работать с Xft, в том числе
        <application>KDE</application>, <application>GNOME</application> и
        <application>Firefox</application>.</para>

      <para>Для применения к шрифтам антиалиасинга, а также
	для настройки параметров антиалиасинга, создайте (или отредактируйте,
	если он уже существует) файл
	<filename>/usr/local/etc/fonts/local.conf</filename>.  Некоторые мощные
	возможности системы шрифтов Xft могут быть настроены при помощи этого
	файла; в этом разделе описаны лишь некоторые простые возможности.  Для
	выяснения всех деталей, пожалуйста, обратитесь к
	&man.fonts-conf.5;.</para>

      <indexterm><primary>XML</primary></indexterm>

      <para>Этот файл должен быть сформирован в формате XML.  Обратите особое
	внимание на регистр символов, и удостоверьтесь, что все тэги корректно
	закрыты.  Файл начинается обычным заголовком XML, за которым следуют
	DOCTYPE и
	тэг <literal>&lt;fontconfig&gt;</literal>:</para>

      <programlisting>
        &lt;?xml version="1.0"?&gt;
        &lt;!DOCTYPE fontconfig SYSTEM "fonts.dtd"&gt;
        &lt;fontconfig&gt;</programlisting>

      <para>Как и говорилось ранее, все шрифты из каталога
	<filename>/usr/local/share/fonts/</filename>, а также
	<filename>~/.fonts/</filename> уже доступны для приложений,
	использующих Xft.  Если вы хотите добавить каталог, отличный от этих
	двух, добавьте строчку, подобную следующей, в файл
	<filename>/usr/local/etc/fonts/local.conf</filename>:</para>

      <programlisting>&lt;dir&gt;/path/to/my/fonts&lt;/dir&gt;</programlisting>

      <para>После добавления новых шрифтов, и особенно новых каталогов со
	шрифтами, вы должны выполнить следующую команду для перестроения
	кэшей шрифтов:</para>

      <screen>&prompt.root; <userinput>fc-cache -f</userinput></screen>

      <para>Антиалиасинг делает границы несколько размытыми, что делает очень
	мелкий текст более читабельным и удаляет <quote>лесенки</quote> из
	текста большого размера, но может вызвать нечёткость при применении к
	тексту обычного размера.  Для исключения размеров шрифтов, меньших 14, из
	антиалиасинга, добавьте такие строки:</para>

      <programlisting>        &lt;match target="font"&gt;
            &lt;test name="size" compare="less"&gt;
                &lt;double&gt;14&lt;/double&gt;
            &lt;/test&gt;
            &lt;edit name="antialias" mode="assign"&gt;
                &lt;bool&gt;false&lt;/bool&gt;
            &lt;/edit&gt;
        &lt;/match&gt;
        &lt;match target="font"&gt;
            &lt;test name="pixelsize" compare="less" qual="any"&gt;
                &lt;double&gt;14&lt;/double&gt;
            &lt;/test&gt;
            &lt;edit mode="assign" name="antialias"&gt;
                &lt;bool&gt;false&lt;/bool&gt;
            &lt;/edit&gt;
        &lt;/match&gt;</programlisting>

      <indexterm>
	<primary>шрифты</primary>

	<secondary>межсимвольное расстояние</secondary>
      </indexterm>

      <para>Для некоторых моноширинных шрифтов антиалиасинг может также
	оказаться неприменимым при определении межсимвольного интервала.  В
	частности, эта проблема возникает с <application>KDE</application>.
	Одним из возможных решений для этого
	является жесткое задание межсимвольного интервала в 100.  Добавьте
	следующие строки:</para>

      <programlisting>       &lt;match target="pattern" name="family"&gt;
           &lt;test qual="any" name="family"&gt;
               &lt;string&gt;fixed&lt;/string&gt;
           &lt;/test&gt;
           &lt;edit name="family" mode="assign"&gt;
               &lt;string&gt;mono&lt;/string&gt;
           &lt;/edit&gt;
        &lt;/match&gt;
        &lt;match target="pattern" name="family"&gt;
            &lt;test qual="any" name="family"&gt;
                &lt;string&gt;console&lt;/string&gt;
            &lt;/test&gt;
            &lt;edit name="family" mode="assign"&gt;
                &lt;string&gt;mono&lt;/string&gt;
            &lt;/edit&gt;
        &lt;/match&gt;</programlisting>

      <para>(это создаст алиасы <literal>"mono"</literal> для других
	общеупотребительных имён шрифтов фиксированного размера), а затем
	добавьте:</para>

      <programlisting>         &lt;match target="pattern" name="family"&gt;
             &lt;test qual="any" name="family"&gt;
                 &lt;string&gt;mono&lt;/string&gt;
             &lt;/test&gt;
             &lt;edit name="spacing" mode="assign"&gt;
                 &lt;int&gt;100&lt;/int&gt;
             &lt;/edit&gt;
         &lt;/match&gt;      </programlisting>

      <para>С некоторыми шрифтами, такими, как Helvetica, при антиалиасинге
	могут возникнуть проблемы .  Обычно это проявляется в виде шрифта,
	который наполовину вертикально обрезан.  Хуже того, это может
	привести к сбоям подобных приложений.  Во избежание этого можно
	добавить следующее в файл <filename>local.conf</filename>:</para>

      <programlisting>         &lt;match target="pattern" name="family"&gt;
             &lt;test qual="any" name="family"&gt;
                 &lt;string&gt;Helvetica&lt;/string&gt;
             &lt;/test&gt;
             &lt;edit name="family" mode="assign"&gt;
                 &lt;string&gt;sans-serif&lt;/string&gt;
             &lt;/edit&gt;
         &lt;/match&gt;        </programlisting>

      <para>После того, как вы закончите редактирование
	<filename>local.conf</filename>, удостоверьтесь, что файл завершен
	тэгом <literal>&lt;/fontconfig&gt;</literal>.  Если этого не сделать,
	ваши изменения будут проигнорированы.</para>

      <para>Наконец, пользователи могут добавлять собственные наборы
	посредством персональных файлов <filename>.fonts.conf</filename>.
	Для этого каждый пользователь должен просто создать файл
	<filename>~/.fonts.conf</filename>.  Этот файл также должен быть в
	формате XML.</para>

      <indexterm><primary>LCD-дисплей</primary></indexterm>
      <indexterm><primary>Шрифты</primary>
	<secondary>LCD-дисплей</secondary></indexterm>

      <para>И последнее замечание: при использовании дисплея LCD может
	понадобиться включение разбиения точек.  При этом компоненты красного,
	зелёного и голубого цветов (разделяемые по горизонтали),
	рассматриваются как отдельные точки для улучшения разрешения экрана
	по горизонтали; результат может оказаться потрясающим.  Для включения
	этого механизма добавьте такую строчку где-нибудь в файле
	<filename>local.conf</filename>:</para>

      <programlisting>
        &lt;match target="font"&gt;
            &lt;test qual="all" name="rgba"&gt;
                &lt;const&gt;unknown&lt;/const&gt;
            &lt;/test&gt;
            &lt;edit name="rgba" mode="assign"&gt;
                &lt;const&gt;rgb&lt;/const&gt;
            &lt;/edit&gt;
        &lt;/match&gt;</programlisting>

      <note>
	<para>В зависимости от типа дисплея, <literal>rgb</literal> может
	  потребоваться заменить на <literal>bgr</literal>,
	  <literal>vrgb</literal> или <literal>vbgr</literal>: пробуйте и
	  смотрите, что работает лучше.</para>
      </note>
    </sect2>
  </sect1>

  <sect1 xml:id="x-xdm">
    <info>
      <title>Менеджер экранов (X Display Manager)</title>

      <authorgroup>
        <author>
          <personname>
            <firstname>Seth</firstname>
            <surname>Kingsley</surname>
          </personname>
          <contrib>Текст предоставил </contrib>
        </author>
      </authorgroup>
    </info>

    <indexterm><primary>X Display Manager</primary></indexterm>
    <para><application>&xorg;</application> включает в себя менеджер
      графических дисплеев, <application>XDM</application>, который может
      использоваться для управления сеансами входа.
      <application>XDM</application> обеспечивает графический интерфейс для
      выбора сервера дисплеев, к которому вы хотите подключиться, а также для
      ввода авторизационной информации, такой, как комбинация учётной записи и
      пароля.</para>

    <para>В этом разделе показывается, как настроить X Display Manager во
      &os;.  Некоторые графические оболочки имеют собственные графические
      менеджеры, управляющие входом в систему.  Обратитесь к <xref
      linkend="x11-wm-gnome"/> для получения инструкций по настройке GNOME
      Display Manager и <xref linkend="x11-wm-kde"/> для получения инструкций
      по настройке KDE Display Manager.</para>
    </sect2>

    <sect2>
      <title>Настройка <application>XDM</application></title>

      <para>Для установки <application>XDM</application> используйте пакадж или
        порт <package>x11/xdm</package>.  После установки
        <application>XDM</application> может быть настроен для запуска при
        загрузке системы путём редактирования следующей строки в
        <filename>/etc/ttys</filename>:</para>

      <screen>ttyv8	"/usr/local/bin/xdm -nodaemon"	xterm	off secure</screen>

      <para>Замените <literal>off</literal> на <literal>on</literal> и
        сохраните откорректированную версию.  <literal>ttyv8</literal> в этой
        строке указывает на то, что <application>XDM</application> будет
        запускаться на девятом виртуальном терминале.</para>

      <para>Каталог с конфигурационными файлами <application>XDM</application>
        находится в <filename>/usr/local/lib/X11/xdm</filename>.  Он содержит
        несколько файлов, используемых для изменения поведения и внешнего вида
        <application>XDM</application>, а также небольшой набор скриптов и
        программ, применяемых для настройки рабочего стола при запуске
        <application>XDM</application>.  В <xref linkend="xdm-config-files"/>
        кратко описывается предназначение каждого из этих файлов.  Точный
        синтаксис и использование этих файлов описывается в &man.xdm.1;.</para>

      <table frame="none" pgwide="1" xml:id="xdm-config-files">
        <title>Конфигурационные файлы XDM</title>

        <tgroup cols="2">
          <thead>
	    <row>
	      <entry>Файл</entry>
	      <entry>Описание</entry>
	    </row>
	  </thead>

	  <tbody>
	    <row>
	      <entry><filename>Xaccess</filename></entry>
              <entry>Протокол для подключения к <application>XDM</application>
                называется X Display Manager Connection Protocol
                (<acronym>XDMCP</acronym>)  Данный файл является набором правил
                для авторизации клиентов, контролирующий
                <acronym>XDMCP</acronym>-соединения с удалённых машин.  По
                умолчанию этот файл не разрешает подключаться никаким удалённым
                клиентам.</entry>
	    </row>

	    <row>
	      <entry><filename>Xresources</filename></entry>
	      <entry>Этот файл управляет внешним видом и поведением экранов
                той части <application>XDM</application>, которая отвечает за
                выбор дисплеев и вход в систему.  Настройки по умолчанию
                соответствуют прямоугольному окну входа в систему с хост-именем
		машины, отображаемым вверху крупным шрифтом, с приглашениями
                <quote>Login:</quote> и <quote>Password:</quote> ниже.  Формат
	        этого файла идентичен файлу app-defaults, описанному в
                документации к <application>&xorg;</application>.</entry>
	    </row>

	    <row>
	      <entry><filename>Xservers</filename></entry>
	      <entry>Список локальных и удалённых дисплеев, которые должны
                отображаться приложением выбора дисплеев в качестве вариантов
	        входа в систему.</entry>
	    </row>

	    <row>
	      <entry><filename>Xsession</filename></entry>
	      <entry>Сценарий, который <application>XDM</application> запускает
                по умолчанию после входа пользователя в систему.  Как правило,
                у каждого пользователя будет иметься собственный сценарий в
	  	файле <filename>~/.xsession</filename>, который имеет более
		высокий приоритет</entry>
	    </row>

	    <row>
	      <entry><filename>Xsetup_</filename>*</entry>

	      <entry>Скрипт для автоматического запуска приложений до перехода
                к интерфейсам диспетчера дисплеев или входа в систему.  Для
                каждого используемого дисплея имеется собственный скрипт с
                названием <filename>Xsetup_*</filename>, где
                <literal>*</literal> обозначает локальный номер дисплея.
		Обычно эти скрипты запускают в фоновом режиме одну или две
                программы, например, <command>xconsole</command>.</entry>
	    </row>

	    <row>
	      <entry><filename>xdm-config</filename></entry>

	      <entry>Глобальный конфигурационный файл для всех экранов
		запущенных на локальной машине</entry>
	      </row>

	    <row>
	      <entry><filename>xdm-errors</filename></entry>

              <entry>Содержит ошибки, сгенерированные серверной
                программой.  Если попытки <application>XDM</application>
                запустить дисплей оканчиваются неудачно, поищите в этом файле
		сообщения об ошибках.  Эти сообщения также записываются в
                пользовательский файл <filename>~/.xsession-errors</filename>
		для каждого подключения.</entry>
	    </row>

            <row>
	      <entry><filename>xdm-pid</filename></entry>

	      <entry>ID исполняющегося процесса
                <application>XDM</application>.</entry>
	    </row>
	  </tbody>
	</tgroup>
      </table>
    </sect2>

    <sect2>
      <title>Настройка удалённого доступа</title>

      <para>По умолчанию только пользователи этой же системы могут входить в
        неё средствами <application>XDM</application>.  Чтобы разрешить
        пользователям других систем подключаться к серверу дисплеев,
	отредактируйте правила управления доступом и включите обработку
	входящих соединений.</para>

      <para>Для настройки <application>XDM</application> на обработку любых
	соединений с удалённых систем, закомментируйте строку
        <literal>DisplayManager.requestPort</literal> файла
        <filename>/usr/local/lib/X11/xdm/xdm-config</filename>, указав
	<literal>!</literal> в её начале:</para>

      <screen>! SECURITY: do not listen for XDMCP or Chooser requests
! Comment out this line if you want to manage X terminals with xdm
DisplayManager.requestPort:     0</screen>

      <para>Сохраните отредактированное и перезапустите
	<application>XDM</application>.  Чтобы ограничить удалённый доступ,
	посмотрите пример записей в файле
	<filename>/usr/local/lib/X11/xdm/Xaccess</filename> и обратитесь к
        &man.xdm.1; для получения дополнительной информации.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="x11-wm">
    <info>
      <title>Графические оболочки</title>

      <authorgroup>
        <author>
          <personname>
            <firstname>Valentino</firstname>
            <surname>Vaschetto</surname>
          </personname>
          <contrib>Текст предоставил </contrib>
          <!-- в июне 2001 -->
        </author>
      </authorgroup>
    </info>

    <para>В этом разделе описывается порядок установки трёх популярных
      графических оболочек на систему &os;.  Под графической оболочка может
      пониматься что угодно, от простого менеджера окон до полнофункционального
      набора приложений для рабочего стола.  В Коллекции Портов в категории
      <filename>x11-wm</filename> доступно более сотни таких оболочек.</para>

    <sect2 xml:id="x11-wm-gnome">
      <title>GNOME</title>

      <indexterm><primary>GNOME</primary></indexterm>

      <para><application>GNOME</application> является графической оболочкой с
        дружественным пользовательским интерфейсом.  В ней имеется панель для
        запуска приложений и отображения состояния, рабочий стол, набор
        инструментов и приложений, а также набор соглашений, облегчающих
        совместную работу и взаимную согласованность приложений.
        Дополнительную информацию относительно <application>GNOME</application>
        во &os; можно найти на сайте <link
        xlink:href="http://www.FreeBSD.org/gnome">http://www.FreeBSD.org/gnome</link>.
        Этот сайт содержит дополнительную документацию по установке, настройке
        и управлении <application>GNOME</application> во &os;.</para>

      <para>Эту графическую оболочку можно установить из пакета:</para>

      <screen>&prompt.root; <userinput>pkg install gnome2</userinput></screen>

      <para>Вместо этого можно построить <application>GNOME</application> из
	портов при помощи команды ниже.  <application>GNOME</application>
	является большим приложением, его компиляция займёт определённое время
        даже на быстром компьютере.</para>

      <screen>&prompt.root; <userinput>cd /usr/ports/x11/gnome2</userinput>
&prompt.root; <userinput>make install clean</userinput></screen>

      <para>Для полноценной работы <application>GNOME</application> требуется
        наличие смонтированной файловой системы <filename>/proc</filename>.
        Добавьте следующую строку в <filename>/etc/fstab</filename> для
        автоматического монтирования этой файловой системы при запуске
        системы:</para>

      <programlisting>proc           /proc       procfs  rw  0   0</programlisting>

      <para>После установки <application>GNOME</application> настройте
        <application>&xorg;</application> на запуск
        <application>GNOME</application>.  Самый простой способ сделать это
        заключается в активации Менеджера дисплеев GNOME, 
        <application>GDM</application>, который устанавливается в составе
        пакета или порта <application>GNOME</application>.  Его можно
        активировать, добавив следующую строку в
        <filename>/etc/rc.conf</filename>:</para>

      <programlisting>gdm_enable="YES"</programlisting>

      <para>Зачастую желательно также запустить все сервисы
        <application>GNOME</application>.  Для этого добавьте вторую строку
        в <filename>/etc/rc.conf</filename>:</para>

      <programlisting>gnome_enable="YES"</programlisting>

      <para><application>GDM</application> теперь запустится автоматически при
        загрузке системы.</para>

      <para>Вторым способом запуска <application>GNOME</application> является
        набор команды <command>startx</command> в командной строке после
        настройки <filename>~/.xinitrc</filename>.  Если указанный файл уже
        существует, то замените строку, в которой запускается используемый
        менеджер окон, на ту, что вызовет
        <filename>/usr/local/bin/gnome-session</filename>.  Если такой файл
        отсутствует, создайте его следующей командой:</para>

      <screen>&prompt.user; <userinput>echo "exec /usr/local/bin/gnome-session" &gt; ~/.xinitrc</userinput></screen>

      <para>Третий метод заключается в использовании
        <application>XDM</application> в качестве менеджера дисплеев.  В этом
        случае создайте выполнимый файл
        <filename>~/.xsession</filename>:</para>

      <screen>&prompt.user; <userinput>echo "#!/bin/sh" &gt; ~/.xsession</userinput>
&prompt.user; <userinput>echo "exec /usr/local/bin/gnome-session" &gt;&gt; ~/.xsession</userinput>
&prompt.user; <userinput>chmod +x ~/.xsession</userinput></screen>

    </sect2>

    <sect2 xml:id="x11-wm-kde">
      <title>KDE</title>

      <indexterm><primary>KDE</primary></indexterm>

      <para><application>KDE</application> является ещё одной простой в
        использовании графической оболочкой.  В неё включен набор приложений с
        общим визуальным и пользовательским подходом, стандартное меню и
        панели инструментов, короткие комбинации клавиш, цветовые схемы,
        интернационализация и централизованное управление настройками рабочего
        стола в диалоговом режиме.  Дополнительную информацию о
	<application>KDE</application> можно найти на сайте <link
        xlink:href="http://www.kde.org/">http://www.kde.org/</link>.
        Поищите информацию, специфичную для &os;, на сайте <link
        xlink:href="http://freebsd.kde.org/">http://freebsd.kde.org</link>.</para>

      <para>Для установки пакета <application>KDE</application>
	наберите:</para>

      <screen>&prompt.root; <userinput>pkg install x11/kde4</userinput></screen>

      <para>Вместо этого можно построить <application>KDE</application> как
        порт при помощи команды ниже.  Процедура установки предусматривает меню
        для выбора компонентов для установки.  <application>KDE</application>
	является больим приложением, для его компиляции потребуется
        определённое время даже на быстром компьютере.</para>

      <screen>&prompt.root; <userinput>cd /usr/ports/x11/kde4</userinput>
&prompt.root; <userinput>make install clean</userinput></screen>

      <indexterm>
        <primary>KDE</primary>
        <secondary>display manager</secondary>
      </indexterm>

      <para><application>KDE</application> требует наличия смонтированной
        файловой системы <filename>/proc</filename>.  Добавьте вот такую строку
        в <filename>/etc/fstab</filename> для автоматического монтирования этой
        файловой системы при запуске:</para>

      <programlisting>proc           /proc       procfs  rw  0   0</programlisting>

      <para>В установочный набор <application>KDE</application> входит
        Менеджер Дисплееы KDE (KDE Display Manager),
        <application>KDM</application>.  Для его активации добавьте следующую
        строку в <filename>/etc/rc.conf</filename>:</para>

      <programlisting>kdm4_enable="YES"</programlisting>

      <para>Другим способом запуска <application>KDE</application> является
        ввод команды <command>startx</command> из командной строки.  Чтобы это
        работало, в файле <filename>~/.xinitrc</filename> должна быть следующая
        строка:</para>

      <programlisting>exec /usr/local/bin/startkde</programlisting>

      <para>Третьим способом запуска <application>KDE</application> является
        использование <application>XDM</application>.  Чтобы это сделать,
        создайте выполнимый файл <filename>~/.xsession</filename> следующим
        образом:</para>

      <screen>&prompt.user; <userinput>echo "#!/bin/sh" &gt; ~/.xsession</userinput>
&prompt.user; <userinput>echo "exec /usr/local/bin/startkde" &gt;&gt; ~/.xsession</userinput>
&prompt.user; <userinput>chmod +x ~/.xsession</userinput></screen>

      <para>После запуска <application>KDE</application> дополнительную
        информацию о порядке использования её различных меню и приложений
        можно найти во встроенной системе помощи.</para>
    </sect2>

    <sect2 xml:id="x11-wm-xfce">
      <title>XFce</title>

      <para><application>Xfce</application> является графической оболочкой,
	построенной на основе инструментального пакета GTK+, используемого в
	<application>GNOME</application>.  Однако она гораздо легче и
	реализует простой, эффективно работающий и лёгкий в использовании
	рабочий стол.  Она полностью настраиваема, имеет главную панель с меню,
        апплетами и кнопками быстрого запуска приложений, включает в себя
        менеджер файлов и звуковой менеджер, а также поддерживает темы рабочего
        стола.  Так как оболочка является быстродействующей, лёгкой и
        эффективной, она идеально подходит для более старых или медленных
        машин с ограниченной оперативной памятью.  Дополнительную информацию о
        <application>Xfce</application> можно найти на сайте <link
        xlink:href="http://www.xfce.org/">http://www.xfce.org</link>.</para>

      <para>Для установки пакета <application>Xfce</application>:</para>

      <screen>&prompt.root; <userinput>pkg install xfce</userinput></screen>

      <para>Либо для построения порта:</para>

      <screen>&prompt.root; <userinput>cd /usr/ports/x11-wm/xfce4</userinput>
&prompt.root; <userinput>make install clean</userinput></screen>

      <para>В отличие от <application>GNOME</application> или
        <application>KDE</application>, <application>Xfce</application> не
        имеет собственного менеджера регистрации.  Для того, чтобы запустить
        <application>Xfce</application> из командной строки, набрав
        <command>startx</command>, сначала добавьте соответствующую запись в
        <filename>~/.xinitrc</filename>:</para>

      <screen>&prompt.user; <userinput>echo "exec /usr/local/bin/startxfce4" &gt; ~/.xinitrc</userinput></screen>

      <para>Альтернативным способом является использование
        <application>XDM</application>.  Для того, чтобы воспользоваться этим
        методом, создайте исполнимый файл
        <filename>~/.xsession</filename>:</para>

      <screen>&prompt.user; <userinput>echo "#!/bin/sh" &gt; ~/.xsession</userinput>
&prompt.user; <userinput>echo "exec /usr/local/bin/startxfce4" &gt;&gt; ~/.xsession</userinput>
&prompt.user; <userinput>chmod +x ~/.xsession</userinput></screen>

    </sect2>
  </sect1>

  <sect1 xml:id="x-compiz-fusion">
    <title>Установка Compiz Fusion</title>

    <para>Одним из способов повышения удовлетворённости от использования
      настольного компьютера является включение красивых 3D-эффектов.</para>

    <para>Установить пакет <application>Compiz&nbsp;Fusion</application> легко,
      однако его настройка требует выполнения нескольких шагов, не описанных
      в документации к порту.</para>

    <sect2 xml:id="x-compiz-video-card">
      <title>Настройка драйвера nVidia для &os;</title>

      <para>Эффекты на рабочем стале могут вызывать достаточно высокую нагрузку
        на графический адаптер.  Для обеспечения хорошей производительности
        графических адаптеров, основанных на решениях nVidia, требуется
        проприетарный драйвер.  Пользователи других графических адаптеров могут
        пропустить этот раздел и продолжить с этапа настройки
        <filename>xorg.conf</filename> configuration.</para>

      <para>Для определения требуемого драйвера nVidia обратитесь к <link
        xlink:href="&url.books.faq;/x.html#idp59950544">вопросу FAQ по этой
        теме</link>.</para>

      <para>После определения корректного драйвера для использования с вашим
        адаптером его установка проста так же, как и установка любого другого
        пакета.</para>

      <para>Например, для установки самой последней версии драйвера:</para>

      <screen>&prompt.root; <userinput>pkg install x11/nvidia-driver</userinput></screen>

      <para>Драйвер создаст модуль ядра, который должен быть загружен при
        запуске системы.  Добавьте следующую строку в файл
        <filename>/boot/loader.conf</filename>:</para>

      <programlisting>nvidia_load="YES"</programlisting>

      <note>
        <para>Несмотря на то, что модуль ядра можно загрузить в работающее ядро
          немедленно при помощи команды типа <command>kldload nvidia</command>,
          следует отметить, что некоторые версии
          <application>&xorg;</application> работают некорректно, если драйвер
          был загружен не во время запуска системы.  После редактирования файла
          <filename>/boot/loader.conf</filename> рекомендуется выполнить
          перезагрузку.</para>
      </note>

      <para>При наличии загруженного модуля ядра, как правило, для включения
        проприетарного драйвера вам требуется изменить только одну строку в
        файле <filename>xorg.conf</filename>:</para>

      <para>Найдите следующую строку в файле
        <filename>/etc/X11/xorg.conf</filename>:</para>

      <programlisting>Driver      "nv"</programlisting>

      <para>и замените её на:</para>

      <programlisting>Driver      "nvidia"</programlisting>

      <para>Запустите графический интерфейс обычным образом, и вы должны
        увидеть приветственную заставку от nVidia.  Всё должно работать в
        обычном режиме.</para>
    </sect2>

    <sect2 xml:id="xorg-configuration">
      <title>Конфигурирование xorg.conf для получения эффектов на рабочем
        столе</title>

      <para>Для активирования <application>Compiz&nbsp;Fusion</application>
        необходимо изменить файл
        <filename>/etc/X11/xorg.conf</filename>:</para>

      <para>Добавьте следующий раздел для включения эффектов композиций:</para>

      <programlisting>Section "Extensions"
    Option         "Composite" "Enable"
    EndSection</programlisting>

      <para>Найдите раздел <quote>Screen</quote>, который должен выглядеть
        похожим на текст ниже:</para>

      <programlisting>Section "Screen"
    Identifier     "Screen0"
    Device         "Card0"
    Monitor        "Monitor0"
    ...</programlisting>

      <para>и добавьте следующие две строки (они будут следовать за
        <quote>Monitor</quote>):</para>

      <programlisting>DefaultDepth    24
    Option         "AddARGBGLXVisuals" "True"</programlisting>

      <para>Найдите подраздел <quote>Subsection</quote>, указывающий на
        разрешение экрана, которое вы хотите использовать.  Например, если вы
        желаете использовать 1280x1024, поищите подраздел, приведённый ниже.
        Если требуемого разрешения нет ни в одном подразделе, вы можете
        добавить соответствующую запись вручную:</para>

      <programlisting>SubSection     "Display"
    Viewport    0 0
    Modes      "1280x1024"
    EndSubSection</programlisting>

      <para>Для настольных цветовых композиций требуется глубина цвета в
        24&nbsp;бита, измените подраздел выше на следующий:</para>

      <programlisting>SubSection     "Display"
    Viewport    0 0
    Depth       24
    Modes      "1280x1024"
    EndSubSection</programlisting>

      <para>Наконец, убедитесь, что загрузка модулей <quote>glx</quote> и
        <quote>extmod</quote> отражена в разделе <quote>Module</quote>:</para>

      <programlisting>Section "Module"
    Load           "extmod"
    Load           "glx"
    ...</programlisting>

      <para>Предыдущие действия могут быть выполнены в автоматизированном
        режиме при помощи пакета <package>x11/nvidia-xconfig</package> запуском
        (в режиме пользователя root):</para>

      <screen>&prompt.root; <userinput>nvidia-xconfig --add-argb-glx-visuals</userinput>
    &prompt.root; <userinput>nvidia-xconfig --composite</userinput>
    &prompt.root; <userinput>nvidia-xconfig --depth=24</userinput></screen>
    </sect2>

    <sect2 xml:id="compiz-fusion">
      <title>Установка и настройка Compiz&nbsp;Fusion</title>

      <para>Установить <application>Compiz&nbsp;Fusion</application> так же
        просто, как и любой другой пакет:</para>

      <screen>&prompt.root; <userinput>pkg install x11-wm/compiz-fusion</userinput></screen>

      <para>После завершения установки запустите ваше графическое окружение и
        в терминальном режиме введите следующие команды (в режиме обычного
        пользователя):</para>

      <screen>&prompt.user; <userinput>compiz --replace --sm-disable --ignore-desktop-hints ccp &amp;</userinput>
    &prompt.user; <userinput>emerald --replace &amp;</userinput></screen>

      <para>Ваш экран померцает в течение нескольких секунд, пока ваш менеджер
        окон (например, <application>Metacity</application> при использовании
        <application>GNOME</application>) заменяется на
        <application>Compiz&nbsp;Fusion</application>.  Приложение
        <application>emerald</application> берёт на себя оформление окон (то
        есть кнопки закрытия, минимизации и максимизации, заголовки и так
        далее).</para>

      <para>Вы можете преобразовать это в тривиальный скрипт и настроить его
        автоматическое выполнение при запуске (к примеру, добавив его в
        <quote>Sessions</quote> рабочего стола
        <application>GNOME</application>):</para>

      <programlisting>#! /bin/sh
    compiz --replace --sm-disable --ignore-desktop-hints ccp &amp;
    emerald --replace &amp;</programlisting>

      <para>Сохраните его в вашем домашнем каталоге под именем, например,
        <filename>start-compiz</filename> и сделайте файл исполняемым:</para>

      <screen>&prompt.user; <userinput>chmod +x ~/start-compiz</userinput></screen>

      <para>После этого воспользуйтесь GUI для добавления в меню
        <guimenuitem>Startup Programs</guimenuitem> (находится в
        <guimenuitem>System</guimenuitem>,
        <guimenuitem>Preferences</guimenuitem>,
        <guimenuitem>Sessions</guimenuitem> на рабочем столе
        <application>GNOME</application>).</para>

      <para>Для реального выбора всех желаемых эффектов и их настроек,
        запустите (снова в режиме обычного пользователя)
        <application>Compiz&nbsp;Config&nbsp;Settings&nbsp;Manager</application>:</para>

      <screen>&prompt.user; <userinput>ccsm</userinput></screen>

      <note>
        <para>В <application>GNOME</application> это можно также найти в меню
         <guimenuitem>System</guimenuitem>,
         <guimenuitem>Preferences</guimenuitem>.</para>
      </note>

      <para>Если при компиляции вы выбрали <quote>gconf support</quote>, то вы
        также сможете просмотреть эти настройки при помощи
        <command>gconf-editor</command> из <literal>apps/compiz</literal>.
      </para>
    </sect2>
  </sect1>

  <sect1 xml:id="x11-understanding">
    <title>Устранение неполадок</title>

    <para>Если мышь не работает, то для продолжения работы её необходимо
      настроить.  В последних версиях <application>Xorg</application>
      разделы <literal>InputDevice</literal> в файле
      <filename>xorg.conf</filename> игнорируются в пользу автоматического
      обнаружения устройств.  Для того, чтобы вернуть старое поведение,
      добавьте следующую строку в раздел <literal>ServerLayout</literal>
      или <literal>ServerFlags</literal> этого файла:</para>

    <programlisting>Option "AutoAddDevices" "false"</programlisting>

    <para>После этого устройства ввода могут быть настроены так же, как в
      предыдущих версиях, вместе с другими необходимыми параметрами
      (например, определяющими переключение раскладок клавиатуры).</para>

    <note>
      <para>Как было объяснено выше, по-умолчанию даемон
        <application>hald</application> будет пытаться распознать
        вашу клавиатуру автоматически. Есть вероятность, что раскладка вашей
        клавиатуры или её модель будут определены некорректно. Такие оболочки,
        как <application>GNOME</application>, <application>KDE</application>
        или <application>Xfce</application>, содержат собственные инструменты
        для настройки клавиатуры.  Тем не менее, можно задать параметры
        клавиатуры явным образом с помощью утилиты &man.setxkbmap.1; или через
        правило настройки <application>hald</application>.</para>

      <para>Например, если требуется использовать клавиатуру стандарта PC 102 с
        французской раскладкой, то необходимо создать конфигурационный файл
        клавиатуры для <application>hald</application> под названием
        <filename>x11-input.fdi</filename> и сохранить его в каталоге
        <filename>/usr/local/etc/hal/fdi/policy</filename>. Этот файл должен
        содержать следующие строки:</para>

      <programlisting>&lt;?xml version="1.0" encoding="iso-8859-1"?&gt;
&lt;deviceinfo version="0.2"&gt;
  &lt;device&gt;
    &lt;match key="info.capabilities" contains="input.keyboard"&gt;
         &lt;merge key="input.x11_options.XkbModel" type="string"&gt;pc102&lt;/merge&gt;
         &lt;merge key="input.x11_options.XkbLayout" type="string"&gt;fr&lt;/merge&gt;
    &lt;/match&gt;
  &lt;/device&gt;
&lt;/deviceinfo&gt;</programlisting>

      <para>Если этот файл уже существует, просто скопируйте и добавьте в ваш
        файл строки, относящиеся к настройке клавиатуры.</para>

      <para>Вы должны будете перезагрузить систему, чтобы заставить
        <application>hald</application> применить настройки.</para>

      <para>Есть возможность выполнить эту же самую настройку из X терминала
        или скрипта следующей командой:</para>

      <screen>&prompt.user; <userinput>setxkbmap -model pc102 -layout fr</userinput></screen>

      <para>В файле
        <filename>/usr/local/share/X11/xkb/rules/base.lst</filename>
        перечислены различные клавиатуры, доступные раскладки и опции.</para>
    </note>

    <indexterm><primary>тонкая настройка <application>&xorg;</application></primary></indexterm>

    <para>Теперь конфигурационный файл <filename>xorg.conf.new</filename>
      может быть тонко настроен на ваш вкус.  Откройте этот файл в текстовом
      редакторе, таком, как &man.emacs.1; или &man.ee.1;.  Если модель
      монитора устарела или является нестандартной и не поддерживает
      автоматическое определение частот развёртки, то эти параметры могут
      быть добавлены в раздел <literal>"Monitor"</literal> файла
      <filename>xorg.conf.new</filename>:</para>

    <programlisting>Section "Monitor"
       Identifier   "Monitor0"
       VendorName   "Monitor Vendor"
       ModelName    "Monitor Model"
       HorizSync    30-107
       VertRefresh  48-120
EndSection</programlisting>

    <para>Большинство мониторов поддерживают автоопределение частоты
      развёртки, что делает ручной ввод этих значений ненужным.  Для
      незначительного количества мониторов, не поддерживающих автоматическое
      определение, следует избегать потенциальной поломки и указывать только
      значения, предоставленные производителем.</para>

    <para>X позволяет использовать возможности технологии DPMS (Energy Star)
      с поддерживающими её мониторами.  Программа &man.xset.1; управляет
      временными задержками и может явно задавать режимы ожидания, останова
      и выключения.  Если вы хотите включить использование возможностей
      DPMS вашего монитора, вы должны добавить следующую строку в раздел,
      описывающий монитор:</para>

    <programlisting>Option       "DPMS"</programlisting>

    <indexterm><primary><filename>xorg.conf</filename></primary></indexterm>

    <para>Пока файл конфигурации <filename>xorg.conf.new</filename> открыт
      в редакторе, выберите желаемые разрешение и глубину цвета, которые
      будут использоваться по умолчанию.  Они задаются в разделе
      <literal>"Screen"</literal>:</para>

    <programlisting>Section "Screen"
       Identifier "Screen0"
       Device     "Card0"
       Monitor    "Monitor0"
       DefaultDepth 24
       SubSection "Display"
               Viewport  0 0
               Depth     24
               Modes     "1024x768"
       EndSubSection
EndSection</programlisting>

    <para>Ключевое слово <literal>DefaultDepth</literal> описывает
      глубину цвета, которая будет применяться по умолчанию.  Это значение
      может быть переопределено при помощи параметра командной строки
      <option>-depth</option> для &man.Xorg.1;.  Ключевое слово
      <literal>Modes</literal> описывает разрешение, с которым нужно
      работать при данной глубине цвета.  Заметьте, что поддерживаются
      только те стандартные режимы VESA, что определены графическим
      оборудованием настраиваемой системы.  В примере выше глубина цвета по
      умолчанию равна двадцати четырём битам на точку.  При такой глубине
      цвета принимается разрешение в 1024 на 768 точек.</para>

    <para>Наконец, запишите конфигурационный файл и протестируйте его при
      помощи тестового режима, описанного выше.</para>

    <note>
      <para>В процессе решения проблем вам могут помочь файлы протоколирования
        <application>&xorg;</application>, в которых находится информация о
        каждом устройстве, к которому подключается сервер
        <application>&xorg;</application>.  Протокольным файлам
        <application>&xorg;</application> названия даются в формате
        <filename>/var/log/Xorg.0.log</filename>.  Конкретное название файла
        протокола может варьироваться от <filename>Xorg.0.log</filename> до
        <filename>Xorg.8.log</filename> и далее.</para>
    </note>

    <para>Если всё в порядке, то конфигурационный файл нужно установить в
      обычное место, где его сможет найти &man.Xorg.1;.  Как правило, это
      <filename>/etc/X11/xorg.conf</filename> или
      <filename>/usr/local/etc/X11/xorg.conf</filename>.</para>

    <screen>&prompt.root; <userinput>cp xorg.conf.new /etc/X11/xorg.conf</userinput></screen>

    <para>Теперь процесс настройки <application>&xorg;</application> завершён.
      <application>&xorg;</application> теперь можно запустить утилитой
      &man.startx.1;.  Сервер <application>&xorg;</application> может быть
      также запущен при помощи &man.xdm.1;.</para>

    <sect2>
      <title>Конфигурирование при работе с графическими чипсетами &intel;
        <literal>i810</literal></title>

      <indexterm><primary>графический чипсет Intel i810</primary></indexterm>

      <para>Конфигурирование при работе с интегрированными наборами микросхем
        &intel; i810 требует наличия <filename>agpgart</filename>,
        программного интерфейса AGP, посредством которого
        <application>&xorg;</application> будет управлять адаптером.
        Подробности смотрите на странице справочника &man.agp.4;.</para>

      <para>Это позволит конфигурировать графическое оборудование точно так
        же, как и любой другой графический адаптер.  Заметьте, что для
        систем, у которых драйвер &man.agp.4; в ядро не вкомпилирован,
        попытка загрузить модуль с помощью &man.kldload.8; не сработает.
        Этот драйвер должен быть в ядре во время загрузки, либо
        вкомпилированным, либо подгруженным посредством
        <filename>/boot/loader.conf</filename>.</para>
    </sect2>

    <sect2>
      <title>Добавление широкоэкранной панели</title>

      <indexterm><primary>настройка широкоэкранной панели</primary></indexterm>

      <para>Этот раздел предполагает наличие определённых глубоких познаний в
        настройке.  Если попытки применить описанные выше инструменты настройки
        к созданию рабочей конфигурации не приводят, в файлах протоколов
        достаточно информации для доведения конфигурации до рабочего состояния.
        Для настройки необходимо использовать текстовый редактор.</para>

      <para>Существующие широкоэкранные стандарты (WSXGA, WSXGA+, WUXGA, WXGA,
        WXGA+ и так далее) поддерживают форматы изображения 16:10 и 10:9,
        которые могут быть проблемными.  Для формата 16:10, например, возможны
        следующие разрешения экрана:</para>

      <itemizedlist>
        <listitem>
          <para>2560x1600</para>
        </listitem>

        <listitem>
          <para>1920x1200</para>
        </listitem>

        <listitem>
          <para>1680x1050</para>
        </listitem>

        <listitem>
          <para>1440x900</para>
        </listitem>

        <listitem>
          <para>1280x800</para>
        </listitem>
      </itemizedlist>

      <para>Это так же легко, как добавить одно из этих
        разрешений в качестве доступного режима (<literal>Mode</literal>) в
        раздел <literal>Section "Screen"</literal> следующим образом:</para>

      <programlisting>Section "Screen"
Identifier "Screen0"
Device     "Card0"
Monitor    "Monitor0"
DefaultDepth 24
SubSection "Display"
       Viewport  0 0
       Depth     24
       Modes     "1680x1050"
EndSubSection
EndSection</programlisting>

      <para><application>&xorg;</application> достаточно умён, чтобы получить
        информацию о разрешении от монитора посредством I2C/DDC, так что у него
        есть данные, какие частоты и разрешения может поддерживать
        монитор.</para>

      <para>Если эти <literal>ModeLine</literal> не определены в драйверах,
        может потребоваться дополнительная настройка
        <application>&xorg;</application>.  Используя
        <filename>/var/log/Xorg.0.log</filename>, можно извлечь достаточно
        информации для создания работающей строки <literal>ModeLine</literal> в
        ручном режиме.  Просто поищите информацию, похожую на такую:</para>

      <programlisting>(II) MGA(0): Supported additional Video Mode:
(II) MGA(0): clock: 146.2 MHz   Image Size:  433 x 271 mm
(II) MGA(0): h_active: 1680  h_sync: 1784  h_sync_end 1960 h_blank_end 2240 h_border: 0
(II) MGA(0): v_active: 1050  v_sync: 1053  v_sync_end 1059 v_blanking: 1089 v_border: 0
(II) MGA(0): Ranges: V min: 48  V max: 85 Hz, H min: 30  H max: 94 kHz, PixClock max 170 MHz</programlisting>

      <para>Это так называемая информация EDID.  Создание
        <literal>ModeLine</literal> из этих данных является вопросом
        расположения значений в правильном порядке:</para>

      <programlisting>ModeLine &lt;name&gt; &lt;clock&gt; &lt;4 horiz. timings&gt; &lt;4 vert. timings&gt;</programlisting>

      <para>Таким образом, для данного примера <literal>ModeLine</literal> в
        разделе <literal>Section "Monitor"</literal> будет выглядеть примерно
        так:</para>

      <programlisting>Section "Monitor"
Identifier      "Monitor1"
VendorName      "Bigname"
ModelName       "BestModel"
ModeLine        "1680x1050" 146.2 1680 1784 1960 2240 1050 1053 1059 1089
Option          "DPMS"
EndSection</programlisting>

      <para>После завершения этих простых шагов по редактированию настроек X
        должны запуститься на вашем новом широкоэкранном мониторе.</para>
    </sect2>

    <sect2 xml:id="compiz-troubleshooting">
      <title>Устранение неполадок Compiz&nbsp;Fusion</title>

      <qandaset>
        <qandaentry>
          <question xml:id="no-decorations">
            <para>Я установил <application>Compiz&nbsp;Fusion</application>, но
              после запуска указанных вами команд мои окна остались без
              заголовков и кнопок.  Что пошло не так?</para>
          </question>

          <answer>
            <para>Вероятно, не хватает настроек в файле
              <filename>/etc/X11/xorg.conf</filename>.  Внимательно
              проанализируйте этот файл, уделив особенное внимание директивам
              <literal>DefaultDepth</literal> и
              <literal>AddARGBGLXVisuals</literal>.</para>
          </answer>
        </qandaentry>

        <qandaentry>
          <question xml:id="xorg-crash">
            <para>Когда я выполняю команду для запуска
              <application>Compiz&nbsp;Fusion</application>, X-сервер аварийно
              прекращает работу и я снова оказываюсь в режиме консоли.  В чём
              ошибка?</para>
          </question>

          <answer>
            <para>Если вы проанализируете файл
              <filename>/var/log/Xorg.0.log</filename>, то, вероятно, найдёте
              сообщения об ошибках при запуске X.  Самыми частыми могут быть
              следующие:</para>

            <screen>(EE) NVIDIA(0):     Failed to initialize the GLX module; please check in your X
    (EE) NVIDIA(0):     log file that the GLX module has been loaded in your X
    (EE) NVIDIA(0):     server, and that the module is the NVIDIA GLX module.  If
    (EE) NVIDIA(0):     you continue to encounter problems, Please try
    (EE) NVIDIA(0):     reinstalling the NVIDIA driver.</screen>

            <para>Эти сообщения, как правило, возникают при обновлении
              <application>&xorg;</application>.  Вам потребуется
              переустановить пакет <package>x11/nvidia-driver</package>, чтобы
              glx был построен снова.</para>
          </answer>
        </qandaentry>
      </qandaset>
    </sect2>
  </sect1>
</chapter>
