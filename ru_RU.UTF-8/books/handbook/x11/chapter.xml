<?xml version="1.0" encoding="utf-8"?>
<!--
     The FreeBSD Russian Documentation Project

     $FreeBSD: head/ru_RU.KOI8-R/books/handbook/x11/chapter.xml 48458 2016-03-23 10:47:11Z amdmi3 $
     $FreeBSDru: frdp/doc/ru_RU.KOI8-R/books/handbook/x11/chapter.xml,v 1.68 2008/05/13 13:46:29 den Exp $

     Original revision: r44739
-->
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="x11">

  <!--
  <chapterinfo> 
    <authorgroup>
      <author>
        <personname>
          <firstname>Ken</firstname>
          <surname>Tom</surname>
        </personname>

        <contrib>Обновили для сервера X.Org X11 </contrib>
      </author>

      <author>
        <personname>
          <firstname>Marc</firstname>
          <surname>Fonvieille</surname>
        </personname>
      </author>
    </authorgroup>
  </chapterinfo> 
  -->

  <title>X Window System</title>

  <sect1 xml:id="x11-synopsis">
    <title>Обзор</title>

    <para>Процедура установки &os; при помощи
      <application>bsdinstall</application> не предусматривает автоматической
      установки графического пользовательского интерфейса.  Эта глава
      описывает процесс установки и настройки пакета
      <application>&xorg;</application>, предоставляющий X Window System с
      открытым кодом, обеспечивающий графическую среду работы.  Затем она
      объясняет, как найти и установить оболочку рабочего стола или оконный
      менеджер.</para>

    <note>
      <para>Пользователи, предпочитающие метод установки, при котором
        <application>&xorg;</application> настраивается автоматически и
        предлагаются варианты выбора оконных менеджеров, должно обратить
        внимание на web-сайт <link
        xlink:href="http://www.pcbsd.org/">pcbsd.org</link>.</para>
    </note>

    <para>Для получения дополнительной информации об оборудовании, которое
      поддерживается в <application>&xorg;</application>, обратитесь к
      web-сайту <link xlink:href="http://www.x.org/">x.org</link>.</para>

    <para>После чтения этой главы вы будете знать:</para>

    <itemizedlist>
      <listitem>
	<para>О различных компонентах X Window System и их
	  взаимодействии.</para>
      </listitem>

      <listitem>
	<para>Как установить и настроить
          <application>&xorg;</application>.</para>
      </listitem>

      <listitem>
	<para>Как установить и настроить несколько оконных менеджеров и
          оболочек рабочего стола.</para>
      </listitem>

      <listitem>
	<para>Как использовать шрифты &truetype; в
          <application>&xorg;</application>.</para>
      </listitem>

      <listitem>
	<para>Как настроить вашу систему на графический интерфейс входа
	  (<application>XDM</application>).</para>
      </listitem>
    </itemizedlist>

    <para>Перед чтением этой главы вам требуется:</para>

    <itemizedlist>
      <listitem>
	<para>Знать, как устанавливать дополнительное программное обеспечение
	  сторонних разработчиков в соответствии с описанием в <xref
          linkend="ports"/>.</para>
      </listitem>
    </itemizedlist>
  </sect1>

  <sect1 xml:id="x-understanding">
    <title>Терминология</title>

    <para>Хотя нет необходимости вникать во все тонкости различных компонент
      X Window System и взаимодействия между ними, некоторые базовые знания
      об этих компонентах могут быть полезными.</para>

    <variablelist>
      <varlistentry>
        <term>X-сервер</term>

        <listitem>
          <para>X изначально разрабатывалась, чтобы быть системой,
            ориентированной на работу в сети, и использует модель
	    <quote>клиент-сервер</quote>.  В этой модели
            <quote>X-сервер</quote> работает на компьютере с
	    клавиатурой, монитором и мышью.  Область ответственности сервера
	    включает управление дисплеем, обработку ввода с клавиатуры и мыши,
            а также обработку ввода и вывода с других устройств, таких, как
            планшет или видеопроектор.  Некоторых это запутывает, потому что
            терминология X в точности противоположна тому, что они ожидают.
            Они полагают, что <quote>X-сервером</quote> будет являться большая
            мощная машина в конце коридора, а <quote>X-клиентом</quote>
            выступает компьютер на их рабочем столе.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>X-клиент</term>

        <listitem>
          <para>Каждое X-приложение, такое, как
            <application>XTerm</application> или
            <application>Firefox</application>, является
	    <quote>клиентом</quote>.  Клиент посылает сообщения серверу,
            такие, как <quote>Пожалуйста, нарисуй окно со следующими
            координатами</quote>, а сервер посылает в ответ сообщения
            типа <quote>Пользователь только что щёлкнул мышью на кнопке
            OK</quote>.</para>

          <para>При использовании дома или в офисе, сервер и клиенты X, как
            правило, работают на том же самом компьютере.  Однако можно также
            запустить X-сервер на более слабом компьютере, а приложения X
            запускать на более мощной системе.  При таком сценарии коммуникации
            между X-клиентом и сервером осуществляются по сети.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>оконный менеджер</term>

        <listitem>
          <para>X не определяется, как окна должны выглядеть на экране, как их
            двигать мышью, какие комбинации клавиш должны использоваться для
            переключения между окнами, как должны выглядеть заголовки окон,
            должны ли в них быть кнопки для закрытия и так далее.  Вместо
            этого X делегирует ответственность за это отдельному приложению
            управления окнами.  Существуют <link
            xlink:href="http://xwinman.org/">десятки оконных менеджеров</link>.
            Каждый оконный менеджер реализует собственный внешний вид и подход
            к управлению: некоторые поддерживают виртуальные рабочие столы,
            некоторые позволяют изменять назначения комбинаций клавиш для
            управления рабочим окружением, в некоторых есть кнопка
            <quote>Start</quote>, а некоторые поддерживают
            <quote>темы</quote>, позволяя полностью менять образ
            рабочего окружения.  Оконные менеджеры находятся в категории
            <filename>x11-wm</filename> Коллекции Портов.</para>

          <para>Каждый оконный менеджер использует собственный механизм
            настройки.  Некоторые предполагают наличие вручную созданного
            конфигурационного файла, тогда как другие предоставляют
            графические инструменты для выполнения большинства задач по
            настройке.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>оболочки рабочего стола</term>

        <listitem>
          <para><application>KDE</application> и
            <application>GNOME</application>, рассматриваются как оболочки
            для организации рабочего стола, так как они включают в себя полный
            набор приложений для выполнения повседневной работы.  Сюда могут
            входить офисные пакеты, web-браузеры и игры.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>политика фокусирования</term>

        <listitem>
          <para>Менеджер окон отвечает за политику фокусирования мыши.  Эта
            политика предоставляет некоторый механизм, который определяет,
            какое окно активно обрабатывает нажатия клавиш, а также визуально
            отображает, какое окно является в настоящий момент активным.</para>

          <para>Одна из политик фокусирования называется
            <quote>фокусирование по щелчку</quote>.  В такой модели окно
            становится активным после получения щелчка мыши.  В политике
            <quote>фокус следует за мышью</quote> фокус получает окно,
            находящееся под указателем мыши, и этот фокус меняется при
            указании на другое окно.  Если мышь находится поверх корневого
            окна, то фокусирование производится на этом окне.  В модели
            <quote>нечёткого фокусирования</quote> при перемещении мыши на
            корневое окно фокус остаётся на последнем используемом окне.
            При нечётком фокусовании фокус меняется только при перемещении
            курсора на новое окно, и не меняется при выходе из текущего окна.
            В политике <quote>фокусирования по щелчку</quote> активное окно
            выбирается щелчком мыши.  Затем это окно может быть вызвано и
            появиться поверх всех других окон.  Все нажатия клавиш
            при этом будут направляться в это окно, даже если указатель
            переместился на другое окно.</para>

          <para>Разные оконные менеджеры поддерживают разные модели
            фокусирования.  Все они поддерживают фокусирование по щелчку, и
            большинство также поддерживает другие политики.  Обратитесь к
            документации по оконному менеджеру для выяснения доступности
            моделей фокусирования.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>виджеты</term>

        <listitem>
          <para>Виджет - это термин, употребляемый для любых объектов
            пользовательского интерфейса, на которые можно щёлкать или которыми
            можно манипулировать каким-либо образом.  Сюда включаются кнопки,
            зависимые и независимые опции, иконки и списки.  Библиотека
            виджетов представляет собой набор виджетов, используемых для
            создания графических приложений.  Существует несколько популярных
            библиотек виджетов, среди которых Qt, используемый в
            <application>KDE</application>, и GTK+, применяемый в
            <application>GNOME</application>.  В результате приложения будут
            иметь разный внешний вид в зависимости от того, какая библиотека
            использовалась для создания приложения.</para>
        </listitem>
      </varlistentry>
    </variablelist>
  </sect1>

  <sect1 xml:id="x-install">
    <title>Установка <application>&xorg;</application></title>

    <para><application>&xorg;</application> является реализацией X Window
      System с открытым кодом, выпущенной X.Org Foundation.  Во &os; она может
      установлена как пакет или как порт.  Мета-порт полного установочного
      набора, в который включены X-серверы, клиенты, библиотеки и шрифты,
      находится в пакете <package>x11/xorg</package>.  Минимальный
      установочный пакет находится в <package>x11/xorg-minimal</package>, при
      этом имеются отдельные
      порты для документации, библиотек и приложений.  В примерах этого раздела
      используется полный установочный пакет
      <application>&xorg;</application>.</para>

    <para>Для построения и установки <application>&xorg;</application> из
      Коллекции портов, выполните следующие команды:</para>

    <screen>&prompt.root; <userinput>cd /usr/ports/x11/xorg</userinput>
&prompt.root; <userinput>make install clean</userinput></screen>

    <note>
      <para>Перед построением полной версии <application>&xorg;</application>
	удостоверьтесь в наличии хотя бы 4&nbsp;GB свободного пространства на
        диске.</para>
    </note>

    <para>Кроме того, <application>&xorg;</application> может быть установлен
      непосредственно из пакетов при помощи следующей команды:</para>

    <screen>&prompt.root; <userinput>pkg install xorg</userinput></screen>
  </sect1>

  <sect1 xml:id="x-config">
    <!--
    <sect1info>
      <authorgroup>
	<author>
          <personname>
            <firstname>Christopher</firstname>
            <surname>Shumway</surname>
          </personname>

          <contrib>Текст в июле 2001 года предоставил</contrib>
        </author>
      </authorgroup>
    </sect1info>
    -->

    <title>Настройка <application>&xorg;</application></title>

    <indexterm><primary>&xorg;</primary></indexterm>
    <indexterm><primary><application>&xorg;</application></primary></indexterm>

    <sect2>
      <title>Перед тем, как начать</title>

      <para>В большинстве случаев <application>&xorg;</application>
        настраивается автоматически.  Тем, кто
        работает с устаревающим или нестандартным оборудованием, может
        пригодиться сбор дополнительной информации об аппаратном обеспечении
        до начала настройки.</para>

      <itemizedlist>
	<listitem>
	  <para>Частоты синхронизации монитора</para>
	</listitem>

	<listitem>
	  <para>Набор микросхем, используемый в видеокарте</para>
	</listitem>

	<listitem>
	  <para>Объём памяти видеокарты</para>
	</listitem>
      </itemizedlist>

      <indexterm>
	<primary>частота горизонтальной синхронизации</primary>
      </indexterm>

      <indexterm>
	<primary>частота горизонтальной развёртки</primary>
        <see>частота горизонтальной синхронизации</see>
      </indexterm>

      <indexterm>
        <primary>частота обновления</primary>
      </indexterm>

      <indexterm>
        <primary>частота вертикальной синхронизации</primary>
        <see>частота обновления</see>
      </indexterm>

      <indexterm>
        <primary>частота вертикальной развёртки</primary>
        <see>частота обновления</see>
      </indexterm>

      <para>Разрешение экрана и частота обновления определяются частотами
        горизонтальной и вертикальной развёрток монитора.  Практически все
        мониторы поддерживают электронное автоопределение этих значений.
        Незначительное количество мониторов не передают эти значения, и
        характеристики должны быть найдены в печатном руководстве или на
        web-сайте производителя.</para>

      <para>Набор микросхем видеокарты также определяется автоматически и
        используется для выбора подходящего видеодрайвера.  На случай, когда
        автоопределение не приводит к нужному результату, полезно знать,
        какой набор микросхем установлен.</para>

      <para>Объём памяти графического адаптера определяет максимальные
        отображаемые разрешение и глубину цвета.</para>

    <sect2>
      <title>Caveats</title>

      <para>Возможности настройки оптимального разрешения зависят от
        оборудования и поддержки, предоставляемой его драйвером.  В настоящее
        время поддержка со стороны драйвера выглядит следующим образом:</para>

      <itemizedlist>
        <listitem>
          <para>NVIDIA: В Коллекции Портов FreeBSD доступны несколько драйверов
            NVIDIA.  Установите драйвер, соответствующий модели оборудования
            NVIDIA.</para>
        </listitem>

        <listitem>
          <para>Intel: начиная с FreeBSD 9.1, поддерживается 3D-ускорение на
            большинстве графических адаптеров Intel, включая IronLake,
            SandyBridge и IvyBridge.  Из-за ограничений имеющейся реализации
            KMS переключиться между графической консолью и виртуальной консолью
            при помощи Crtl+Alt+F# невозможно.</para>
        </listitem>

        <listitem>
          <para>ATI/Radeon: 3D-ускорение не будет работать на адаптерах ATI или
            Radeon, пока FreeBSD не закончит свою работу над TTM.  Указанные
            адаптеры необходимо настраивать с драйвером 2D, и если это не
            сработает, то с драйвером Vesa.</para>
        </listitem>

        <listitem>
          <para>Optimus: В настоящее время поддержка переключения между двумя
            графическими адаптерами, доступными в Optimus.  Реализации Optimus
            различаются между собой, так что во FreeBSD не на всяком
            оборудовании гарантируется успешная загрузка графического драйвера.
            Если вы получили пустой экран, проверьте наличии в BIOS опции по
            отключению одного из графических адаптеров или установки режима
            <quote>discrete</quote>.</para>
        </listitem>
      </itemizedlist>
    </sect2>

    <sect2>
      <title>Настройка <application>&xorg;</application></title>

      <para><application>&xorg;</application> использует <acronym>HAL</acronym>
        для автоматического поиска клавиатуры и мыши.
	Порты <package>sysutils/hal</package> и
	<package>devel/dbus</package> автоматически устанавливаются как
	зависимости <package>x11/xorg</package>, но для
	их включения необходимо добавить следующие записи в файл
	<filename>/etc/rc.conf</filename>:</para>

      <programlisting>hald_enable="YES"
dbus_enable="YES"</programlisting>

      <para>Запустите эти сервисы до того, как настраивать
        <application>&xorg;</application>:</para>

      <screen>&prompt.root; <userinput>service hald start</userinput>
&prompt.root; <userinput>service dbus start</userinput></screen>

      <para>Как только эти сервисы будут запущены, проверьте автоматическую
        настройку <application>&xorg;</application>, набрав:</para>

      <screen>&prompt.root; <userinput>Xorg -configure</userinput></screen>

      <para>Эта команда создаст файл <filename>/root/xorg.conf.new</filename>,
        который пытается загрузить подходящие драйверы для обнаруженного
        оборудования.  После этого проверьте, что автоматически сгенерированный
        конфигурационный файл работает с графическим оборудованием,
        набрав:</para>

      <screen>&prompt.root; <userinput>Xorg -config xorg.conf.new -retro</userinput></screen>

      <para>Если появилась чёрно-белая сетка и курсор мыши в виде X, то
        настройка была выполнена успешно.  Для выхода из режима тестирования
	переключитесь в виртуальную консоль, которая использовалась для
        запуска, нажав
	<keycombo action="simul">
	  <keycap>Ctrl</keycap>
	  <keycap>Alt</keycap>
          <keycap>F<replaceable>n</replaceable></keycap>
        </keycombo> (<keycap>F1</keycap> соответствует первой виртуальной
        консоли), а затем нажмите
        <keycombo action="simul">
          <keycap>Ctrl</keycap>
          <keycap>C</keycap>
        </keycombo>.</para>

      <note>
        <para>Для выхода из <application>&xorg;</application> также может быть
          использована комбинация клавиш
          <keycombo action="simul">
            <keycap>Ctrl</keycap>
            <keycap>Alt</keycap>
            <keycap>Backspace</keycap>
          </keycombo>.  Для включения такой возможности вы должны либо ввести
          следующую команду в любом эмуляторе X терминала:</para>

	<screen>&prompt.user; <userinput>setxkbmap -option terminate:ctrl_alt_bksp</userinput></screen>

	<para>либо создать конфигурационный файл клавиатуры для
	  <application>hald</application> называемый
	  <filename>x11-input.fdi</filename> и сохранить его в каталоге
	  <filename>/usr/local/etc/hal/fdi/policy</filename>.  Данный файл
          должен содержать следующие строки:</para>

	<programlisting>&lt;?xml version="1.0" encoding="iso-8859-1"?&gt;
&lt;deviceinfo version="0.2"&gt;
  &lt;device&gt;
    &lt;match key="info.capabilities" contains="input.keyboard"&gt;
	  &lt;merge key="input.x11_options.XkbOptions" type="string"&gt;terminate:ctrl_alt_bksp&lt;/merge&gt;
    &lt;/match&gt;
  &lt;/device&gt;
&lt;/deviceinfo&gt;</programlisting>

	<para>Вам необходимо будет перезагрузить систему для вступления
          параметров <application>hald</application> в силу.</para>

        <para>В раздел <literal>ServerLayout</literal> или
          <literal>ServerFlags</literal> файла
          <filename>xorg.conf.new</filename> необходимо будет также добавить
          следующую строку:</para>

        <programlisting>Option  "DontZap"       "off"</programlisting>
      </note>

      <para>Если тест закончился неудачно, перейдите к <xref
        linkend="x11-understanding"/>.  Если тестирование прошло успешно,
        скопируйте конфигурационный файл в
        <filename>/etc/X11/xorg.conf</filename>:</para>

      <screen>&prompt.root; <userinput>cp xorg.conf.new /etc/X11/xorg.conf</userinput></screen>

      <note>
	<para>Оболочки типа <application>GNOME</application>,
	  <application>KDE</application> или
	  <application>Xfce</application> содержат визуальные инструменты для
          настройки таких параметров, как разрешение экрана.  Если настройки,
          применённые по умолчанию, подошли, перейдите к разделу <xref
          linkend="x11-wm"/> для поиска примеров установки оболочек рабочего
          стола.</para>
      </note>
    </sect2>
  </sect1>

  <sect1 xml:id="x-fonts">
    <!--
    <sect1info>
      <authorgroup>
	<author>
          <personname>
            <firstname>Murray</firstname>
            <surname>Stokely</surname>
          </personname><contrib>Текст предоставил </contrib></author>
      </authorgroup>
    </sect1info>
    -->

    <title>Использование шрифтов в <application>&xorg;</application></title>

    <sect2 xml:id="type1">
      <title>Шрифты Type1</title>

      <para>Шрифты, используемые по умолчанию и распространяемые вместе с
	<application>&xorg;</application>, вряд ли можно назвать идеально
        подходящими для применения в
        обычных издательских приложениях.  Большие презентационные шрифты
        выглядят рвано и непрофессионально, а мелкие шрифты вообще невозможно
	разобрать.  Однако есть некоторое количество свободно распространяемых
	высококачественных шрифтов Type1 (&postscript;), которые можно без
	изменений использовать с <application>&xorg;</application>.  К примеру,
        в наборе шрифтов URW
	(<package>x11-fonts/urwfonts</package>) имеются
	высококачественные версии стандартных шрифтов type1 (<trademark
        class="registered">Times Roman</trademark>, <trademark
        class="registered">Helvetica</trademark>, <trademark
        class="registered">Palatino</trademark> и другие).  В набор Freefonts
	(<package>x11-fonts/freefonts</package>) включено ещё
	больше шрифтов, однако большинство из них предназначено для
	использования в программном обеспечении для работы с графикой,
	например, <application>Gimp</application>, и они не вполне пригодны
	для использования в качестве
	экранных шрифтов.  Кроме того, <application>&xorg;</application> с
	минимальными усилиями может быть настроена на использование шрифтов
	&truetype;. Более подробную информацию можно найи на странице
	справочной системы &man.X.7; или в <link linkend="truetype"/>.</para>

      <para>Для установки вышеупомянутых коллекций шрифтов Type1 из Коллекции
	Портов выполните следующие команды:</para>

      <screen>&prompt.root; <userinput>cd /usr/ports/x11-fonts/urwfonts</userinput>
&prompt.root; <userinput>make install clean</userinput></screen>

      <para>То же самое нужно будет сделать для коллекции freefont и других.
	Чтобы X-сервер обнаруживал
	этих шрифты, добавьте соответствующую строку в
	файл настройки X сервера (<filename>/etc/X11/xorg.conf</filename>),
	которая должна выглядеть так:</para>

      <programlisting>FontPath "/usr/local/lib/X11/fonts/URW/"</programlisting>

      <para>Либо из командной строки при работе с X выполните:</para>

      <screen>&prompt.user; <userinput>xset fp+ /usr/local/lib/X11/fonts/URW</userinput>
&prompt.user; <userinput>xset fp rehash</userinput></screen>

      <para>Это сработает, но будет потеряно, когда сеанс работы с X будет
	закрыт, если эта команда не будет добавлена в начальный файл
	(<filename>~/.xinitrc</filename> в случае обычного сеанса через
	<command>startx</command>
	или <filename>~/.xsession</filename> при входе через графический
	менеджер типа <application>XDM</application>).  Третий способ
	заключается в использовании нового файла
	<filename>/usr/local/etc/fonts/local.conf</filename>, как это показано
        в <xref linkend="antialias"/>.</para>
    </sect2>

    <sect2 xml:id="truetype">
      <title>Шрифты &truetype;</title>

      <indexterm><primary>Шрифты TrueType</primary></indexterm>
      <indexterm>
	<primary>шрифты</primary>
	<secondary>TrueType</secondary>
      </indexterm>

      <para>В <application>&xorg;</application> имеется встроенная
	поддержка шрифтов &truetype;.  Имеются два модуля, которые могут
	обеспечить эту функциональность.  В нашем примере используется модуль
	freetype, потому что он в большей степени похож на другие механизмы
	для работы с шрифтами.  Для включения модуля freetype достаточно в
	раздел <literal>"Module"</literal> файла
	<filename>/etc/X11/xorg.conf</filename> добавить следующую
	строчку.</para>

      <programlisting>Load  "freetype"</programlisting>

      <para>Теперь создайте каталог для шрифтов &truetype;
	(к примеру, <filename>/usr/local/lib/X11/fonts/TrueType</filename>) и
	скопируйте все шрифты &truetype; в этот каталог.  Имейте в виду,
	что напрямую использовать шрифты &truetype; с &macintosh; нельзя;
	для использования с <application>&xorg;</application> они должны
	быть в формате &unix;/&ms-dos;/&windows;.  После того, как файлы будут
	скопированы в этот каталог, воспользуйтесь утилитой
	<application>ttmkfdir</application> для создания файла
	<filename>fonts.dir</filename>, который укажет подсистеме вывода
	шрифтов X на местоположение этих новых файлов.
	<command>ttmkfdir</command> имеется в Коллекции Портов FreeBSD как
	<package>x11-fonts/ttmkfdir</package>.</para>

      <screen>&prompt.root; <userinput>cd /usr/local/lib/X11/fonts/TrueType</userinput>
&prompt.root; <userinput>ttmkfdir -o fonts.dir</userinput></screen>

      <para>Теперь добавьте каталог со шрифтами &truetype;
	к маршруту поиска шрифтов.  Это делается точно также, как описано в
        <xref linkend="type1"/>:</para>

      <screen>&prompt.user; <userinput>xset fp+ /usr/local/lib/X11/fonts/TrueType</userinput>
&prompt.user; <userinput>xset fp rehash</userinput></screen>

      <para>или добавьте строку <option>FontPath</option> в файл
	<filename>xorg.conf</filename>.</para>

      <para>Это всё.  Теперь <application>Gimp</application>,
	<application>Apache OpenOffice</application> и все остальные приложения
        для X должны обнаружить установленные шрифты &truetype;.  Очень
        маленькие (как
	текст веб-страницы на дисплее с высоким разрешением) и очень большие (в
	<application>&staroffice;</application>) шрифты будут теперь выглядеть
	гораздо лучше.</para>
    </sect2>

    <sect2 xml:id="antialias">
      <!--
      <sect2info>
        <authorgroup>
	  <author>
            <personname>
              <firstname>Joe Marcus</firstname>
              <surname>Clarke</surname>
            </personname>

            <contrib>Обновление выполнил </contrib>
          </author>
        </authorgroup>
      </sect2info>
      -->

      <title>Шрифты с антиалиасингом</title>

      <indexterm>
	<primary>шрифты с антиалиасингом</primary>
      </indexterm>

      <indexterm>
	<primary>шрифты</primary>

	<secondary>антиалиасинг</secondary>
      </indexterm>

      <para>Все шрифты <application>&xorg;</application>, расположенные в
        каталогах <filename>/usr/local/lib/X11/fonts/</filename> и
	<filename>~/.fonts/</filename>, автоматически становятся доступными для
	применения антиалиасинга в приложениях, использующих Xft.
        Большинство современных приложений умеет работать с Xft, в том числе
        <application>KDE</application>, <application>GNOME</application> и
        <application>Firefox</application>.</para>

      <para>Для применения к шрифтам антиалиасинга, а также
	для настройки параметров антиалиасинга, создайте (или отредактируйте,
	если он уже существует) файл
	<filename>/usr/local/etc/fonts/local.conf</filename>.  Некоторые мощные
	возможности системы шрифтов Xft могут быть настроены при помощи этого
	файла; в этом разделе описаны лишь некоторые простые возможности.  Для
	выяснения всех деталей, пожалуйста, обратитесь к
	&man.fonts-conf.5;.</para>

      <indexterm><primary>XML</primary></indexterm>

      <para>Этот файл должен быть сформирован в формате XML.  Обратите особое
	внимание на регистр символов, и удостоверьтесь, что все тэги корректно
	закрыты.  Файл начинается обычным заголовком XML, за которым следуют
	DOCTYPE и
	тэг <literal>&lt;fontconfig&gt;</literal>:</para>

      <programlisting>
        &lt;?xml version="1.0"?&gt;
        &lt;!DOCTYPE fontconfig SYSTEM "fonts.dtd"&gt;
        &lt;fontconfig&gt;</programlisting>

      <para>Как и говорилось ранее, все шрифты из каталога
	<filename>/usr/local/lib/X11/fonts/</filename>, а также
	<filename>~/.fonts/</filename> уже доступны для приложений,
	использующих Xft.  Если вы хотите добавить каталог, отличный от этих
	двух, добавьте строчку, подобную следующей, в файл
	<filename>/usr/local/etc/fonts/local.conf</filename>:</para>

      <programlisting>&lt;dir&gt;/path/to/my/fonts&lt;/dir&gt;</programlisting>

      <para>После добавления новых шрифтов, и особенно новых каталогов со
	шрифтами, вы должны выполнить следующую команду для перестроения
	кэшей шрифтов:</para>

      <screen>&prompt.root; <userinput>fc-cache -f</userinput></screen>

      <para>Антиалиасинг делает границы несколько размытыми, что делает очень
	мелкий текст более читабельным и удаляет <quote>лесенки</quote> из
	текста большого размера, но может вызвать нечёткость при применении к
	тексту обычного размера.  Для исключения размеров шрифтов, меньших 14, из
	антиалиасинга, добавьте такие строки:</para>

      <programlisting>        &lt;match target="font"&gt;
            &lt;test name="size" compare="less"&gt;
                &lt;double&gt;14&lt;/double&gt;
            &lt;/test&gt;
            &lt;edit name="antialias" mode="assign"&gt;
                &lt;bool&gt;false&lt;/bool&gt;
            &lt;/edit&gt;
        &lt;/match&gt;
        &lt;match target="font"&gt;
            &lt;test name="pixelsize" compare="less" qual="any"&gt;
                &lt;double&gt;14&lt;/double&gt;
            &lt;/test&gt;
            &lt;edit mode="assign" name="antialias"&gt;
                &lt;bool&gt;false&lt;/bool&gt;
            &lt;/edit&gt;
        &lt;/match&gt;</programlisting>

      <indexterm>
	<primary>шрифты</primary>

	<secondary>межсимвольное расстояние</secondary>
      </indexterm>

      <para>Для некоторых моноширинных шрифтов антиалиасинг может также
	оказаться неприменимым при определении межсимвольного интервала.  В
	частности, эта проблема возникает с <application>KDE</application>.
	Одним из возможных решений для этого
	является жесткое задание межсимвольного интервала в 100.  Добавьте
	следующие строки:</para>

      <programlisting>       &lt;match target="pattern" name="family"&gt;
           &lt;test qual="any" name="family"&gt;
               &lt;string&gt;fixed&lt;/string&gt;
           &lt;/test&gt;
           &lt;edit name="family" mode="assign"&gt;
               &lt;string&gt;mono&lt;/string&gt;
           &lt;/edit&gt;
        &lt;/match&gt;
        &lt;match target="pattern" name="family"&gt;
            &lt;test qual="any" name="family"&gt;
                &lt;string&gt;console&lt;/string&gt;
            &lt;/test&gt;
            &lt;edit name="family" mode="assign"&gt;
                &lt;string&gt;mono&lt;/string&gt;
            &lt;/edit&gt;
        &lt;/match&gt;</programlisting>

      <para>(это создаст алиасы <literal>"mono"</literal> для других
	общеупотребительных имён шрифтов фиксированного размера), а затем
	добавьте:</para>

      <programlisting>         &lt;match target="pattern" name="family"&gt;
             &lt;test qual="any" name="family"&gt;
                 &lt;string&gt;mono&lt;/string&gt;
             &lt;/test&gt;
             &lt;edit name="spacing" mode="assign"&gt;
                 &lt;int&gt;100&lt;/int&gt;
             &lt;/edit&gt;
         &lt;/match&gt;      </programlisting>

      <para>С некоторыми шрифтами, такими, как Helvetica, при антиалиасинге
	могут возникнуть проблемы .  Обычно это проявляется в виде шрифта,
	который наполовину вертикально обрезан.  Хуже того, это может
	привести к сбоям подобных приложений.  Во избежание этого можно
	добавить следующее в файл <filename>local.conf</filename>:</para>

      <programlisting>         &lt;match target="pattern" name="family"&gt;
             &lt;test qual="any" name="family"&gt;
                 &lt;string&gt;Helvetica&lt;/string&gt;
             &lt;/test&gt;
             &lt;edit name="family" mode="assign"&gt;
                 &lt;string&gt;sans-serif&lt;/string&gt;
             &lt;/edit&gt;
         &lt;/match&gt;        </programlisting>

      <para>После того, как вы закончите редактирование
	<filename>local.conf</filename>, удостоверьтесь, что файл завершен
	тэгом <literal>&lt;/fontconfig&gt;</literal>.  Если этого не сделать,
	ваши изменения будут проигнорированы.</para>

      <para>Наконец, пользователи могут добавлять собственные наборы
	посредством персональных файлов <filename>.fonts.conf</filename>.
	Для этого каждый пользователь должен просто создать файл
	<filename>~/.fonts.conf</filename>.  Этот файл также должен быть в
	формате XML.</para>

      <indexterm><primary>LCD-дисплей</primary></indexterm>
      <indexterm><primary>Шрифты</primary>
	<secondary>LCD-дисплей</secondary></indexterm>

      <para>И последнее замечание: при использовании дисплея LCD может
	понадобиться включение разбиения точек.  При этом компоненты красного,
	зелёного и голубого цветов (разделяемые по горизонтали),
	рассматриваются как отдельные точки для улучшения разрешения экрана
	по горизонтали; результат может оказаться потрясающим.  Для включения
	этого механизма добавьте такую строчку где-нибудь в файле
	<filename>local.conf</filename>:</para>

      <programlisting>
        &lt;match target="font"&gt;
            &lt;test qual="all" name="rgba"&gt;
                &lt;const&gt;unknown&lt;/const&gt;
            &lt;/test&gt;
            &lt;edit name="rgba" mode="assign"&gt;
                &lt;const&gt;rgb&lt;/const&gt;
            &lt;/edit&gt;
        &lt;/match&gt;</programlisting>

      <note>
	<para>В зависимости от типа дисплея, <literal>rgb</literal> может
	  потребоваться заменить на <literal>bgr</literal>,
	  <literal>vrgb</literal> или <literal>vbgr</literal>: пробуйте и
	  смотрите, что работает лучше.</para>
      </note>
    </sect2>
  </sect1>

  <sect1 xml:id="x-xdm">
    <!--
    <sect1info>
      <authorgroup>
	<author>
          <personname>
            <firstname>Seth</firstname>
            <surname>Kingsley</surname>
          </personname>

          <contrib>Текст предоставил </contrib>
        </author>
      </authorgroup>
    </sect1info>
    -->

    <title>Менеджер экранов (X Display Manager)</title>

    <sect2>
      <title>Вступление</title>

      <indexterm>
	<primary>X Display Manager</primary>
      </indexterm>

      <para>Менеджер Экранов X (<application>XDM</application>) это
	необязательный компонент
	X Window System, который используется для управления входом
	пользователей в систему.
	Это полезно в ряде ситуаций, например для минимальных
	<quote>X Терминалов</quote>,
	десктопов, больших сетевых серверов экранов. Так как X Window System
	не зависит от сетей и протоколов, то существует множество различных
	конфигураций для X клиентов и серверов, запущенных на различных
	компьютерах, подключенных к сети.  <application>XDM</application>
	предоставляет графический
	интерфейс для выбора сервера, к которому вы желаете подключится, и
	введения информации, авторизующей пользователя, например комбинации
	логина и пароля.</para>

      <para><application>XDM</application> можно рассматривать как аналог
	программы &man.getty.8;, предоставляющий такие же возможности
	для пользователей
	(смотрите <xref linkend="term-config"/> для подробной информации).
	И это именно так, <application>XDM</application> производит вход в
	систему для подключенного
	пользователя и запускает управляющую сессию для пользователя (обычно
	это менеджер окон X). После этого <application>XDM</application>
	ожидает завершения
	приложения, означающее завершение пользователем работы и
	отключает управляющую сессию.  Затем
	<application>XDM</application> может снова вывести
	приглашение к входу в систему и ожидать входа другого пользователя.
      </para>
    </sect2>

    <sect2>
      <title>Использование XDM</title>

      <para>Для того, чтобы начать использовать <application>XDM</application>,
        установите порт <package>x11/xdm</package> (в последних версиях
        <application>&xorg;</application> по умолчанию он не устанавливается).
        После этого даемон <application>XDM</application> можно найти в
	<filename>/usr/local/bin/xdm</filename>.  Эта программа может быть
	запущена в любой момент пользователем <systemitem
        class="username">root</systemitem>, и
	она начнёт управлять дисплеем X на локальной машине.
	Если <application>XDM</application> нужно запускать
	в фоновом режиме каждый раз при запуске компьютера, то наиболее
	правильный способ &mdash; это добавить новую запись в
	<filename>/etc/ttys</filename>. Для более подробной информации о
	формате и использовании этого файла смотрите <xref
        linkend="term-etcttys"/>.  Вот строка, которую необходимо добавить
	в файл <filename>/etc/ttys</filename> для того, чтобы запустить
	даемон <application>XDM</application> на виртуальном терминале:</para>

      <screen>ttyv8	"/usr/local/bin/xdm -nodaemon"	xterm	off secure</screen>

      <para>По умолчанию эта запись отключена; для её включения
	нужно заменить пятое поле с <literal>off</literal> на
	<literal>on</literal> и перезапустить &man.init.8;, используя метод,
	описанный в <xref linkend="term-hup"/>.  Первое поле это название
	терминала, которым будет управлять программа, <literal>ttyv8</literal>.
	Это означает, что <application>XDM</application> будет запущен на 9ом
	виртуальном терминале.</para>    </sect2>

    <sect2>
      <title>Конфигурирование XDM</title>

      <para>Конфигурационные файлы <application>XDM</application> находятся в
	каталоге
	<filename>/usr/local/lib/X11/xdm</filename>.  В нём размещаются
	насколько файлов, которые используются для изменения
	поведения и внешнего вида <application>XDM</application>.
	Обычно это следующие файлы:</para>

	<informaltable frame="none" pgwide="1">
	  <tgroup cols="2">
	    <thead>
	      <row>
		<entry>Файл</entry>
		<entry>Описание</entry>
	      </row>
	    </thead>

	    <tbody>
	      <row>
		<entry><filename>Xaccess</filename></entry>
		<entry>Правила авторизации клиентов.</entry>
	      </row>

	      <row>
		<entry><filename>Xresources</filename></entry>
		<entry>Значения ресурсов X по умолчанию.</entry>
	      </row>

	      <row>
		<entry><filename>Xservers</filename></entry>
		<entry>Список локальных и удаленных экранов.</entry>
	      </row>

	      <row>
		<entry><filename>Xsession</filename></entry>
		<entry>Сценарий сессии по умолчанию.</entry>
	      </row>

	      <row>
		<entry><filename>Xsetup_</filename>*</entry>

	        <entry>Скрипт для запуска приложений до появления приглашения
	          к входу в систему.</entry>
	      </row>

	      <row>
		<entry><filename>xdm-config</filename></entry>
		<entry>Глобальный конфигурационный файл для всех экранов
		  запущенных на локальной машине</entry>
	      </row>

	      <row>
		<entry><filename>xdm-errors</filename></entry>
		<entry>Ошибки сгенерированные серверной программой.</entry>
	      </row>

	      <row>
		<entry><filename>xdm-pid</filename></entry>
		<entry>ID процесса запущенного XDM.</entry>
	      </row>
	    </tbody>
	  </tgroup>
	</informaltable>

      <para>В этом каталоге также находятся несколько командных сценариев
	и программ, используемых для настройки рабочего стола (desktop)
	при запуске <application>XDM</application>.  Назначение
	каждого из этих файлов будет вкратце описано.  Точный синтаксис и
	информация по их использованию находятся в &man.xdm.1;.</para>

      <para>В конфигурации по умолчанию выводится простое прямоугольное окно
	приглашения ко входу в систему с именем компьютера, написанным
	сверху большим шрифтом, и строками ввода <quote>Login:</quote> и
	<quote>Password:</quote> внизу. Это хорошая отправная точка
	для изменения внешнего вида экранов
	<application>XDM</application>.</para>

      <sect3>
	<title>Xaccess</title>

	<para>Протокол, по которому происходит подключение дисплеев,
	  управляемых <application>XDM</application>, называется X Display
	  Manager Connection
	  Protocol (XDMCP).  Этот файл представляет собой
	  набор правил для управления XDMCP соединениями с
	  удалёнными машинами.  Он игнорируется, пока
	  стандартный файл <filename>xdm-config</filename> не содержит
	  указаний по обслуживанию удалённых соединений.</para>
      </sect3>

      <sect3>
	<title>Xresources</title>

	<para>Это файл содержит установки по умолчанию для
	  приложений, запущенных в экране выбора серверов и экране
	  приглашения к входу в систему.  В нем может быть
	  изменён вид программы входа в систему. Формат этого файла
	  идентичен файлу app-defaults, описанному
	  в документации к <application>&xorg;</application>.</para>
      </sect3>

      <sect3>
	<title>Xservers</title>

	<para>Это список удаленных экранов, которые XDM должен предоставить
	  как варианты для входа в систему.</para>
      </sect3>

      <sect3>
	<title>Xsession</title>
	<para>Этот файл представляет из себя командный сценарий по умолчанию
	  для пользователей, вошедших в систему с использованием
	  <application>XDM</application>.
	  Обычно каждый пользователь имеет собственный сценарий входа в файле
	  <filename>~/.xsession</filename>, который используется
	  вместо этого сценария.</para>
      </sect3>

      <sect3>
	<title>Xsetup_*</title>
	<para>Они запускаются автоматически перед тем, как показывается экран
	  выбора сервера или экран входа в систему. Для каждого экрана
	  (display) есть свой сценарий с именем <filename>Xsetup_</filename>,
	  за которым следует локальный номер экрана (например,
	  <filename>Xsetup_0</filename>).
	  Обычно эти сценарии запускают одну или две программы в
	  фоновом режиме, например <command>xconsole</command>.</para>
      </sect3>

      <sect3>
	<title>xdm-config</title>

	<para>Здесь содержатся настройки в формате app-defaults,
	  которые применимы ко всем экранам данного компьютера.</para>
      </sect3>

      <sect3>
	<title>xdm-errors</title>

	<para>Здесь находится выдача X серверов, которые
	  <application>XDM</application> пытается запустить.  Если экран,
	  который <application>XDM</application> пытается
	  открыть, отключается по некоторым причинам, то это хорошее
	  место для поиска сообщений об ошибках. Эти сообщения также
	  записываются в пользовательский файл
	  <filename>~/.xsession-errors</filename> для каждого сеанса.</para>
      </sect3>
    </sect2>

    <sect2>
      <title>Использование сетевого сервера дисплеев</title>

      <para>Для того, чтобы позволить другим клиентам подключаться к серверу
	дисплеев, необходимо отредактировать правила
	контроля доступа и включить обслуживание сетевых соединений.
	По умолчанию они выключены, что является хорошим решением
	с точки зрения обеспечения безопасности.  Для того, чтобы
	позволить <application>XDM</application> принимать сетевые соединения,
	в первую очередь
	закомментируйте строку в файле <filename>xdm-config</filename>:</para>

      <screen>! БЕЗОПАСНОСТЬ: do not listen for XDMCP or Chooser requests
! Закомментируйте эти линии, если вы хотите управлять X терминалами с xdm
DisplayManager.requestPort:     0</screen>

      <para>и потом перезапустите <application>XDM</application>.  Помните,
	что комментарии в файлах app-defaults начинаются с символа
	<quote>!</quote>, а не как обычно, <quote>#</quote>.  Может
	потребоваться более жёсткий контроль доступа &mdash; взгляните на примеры из
	<filename>Xaccess</filename> и обратитесь к странице справочника
	&man.xdm.1; за дальнейшей информацией.</para>
    </sect2>

    <sect2>
      <title>Замены для XDM</title>

      <para>Существует несколько программ, заменяющих
	<application>XDM</application>.  Одна из них,
	<application>KDM</application> (поставляемая вместе с
	<application>KDE</application>), описана далее в этой главе.  В
	<application>KDM</application> имеется много визуальных и
	косметических улучшений, а также функциональность, позволяющая
	пользователям выбирать собственные оконные менеджеры во время
	входа в систему.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="x11-wm">
    <info>
      <title>Графические оболочки</title>

      <authorgroup>
        <author>
          <personname>
            <firstname>Valentino</firstname>
            <surname>Vaschetto</surname>
          </personname>
          <!--
          <contrib>Текст предоставил в июне 2001 года </contrib> -->
        </author>
      </authorgroup>
    </info>

    <para>В этом разделе описывается порядок установки трёх популярных
      графических оболочек на систему &os;.  Под графической оболочка может
      пониматься что угодно, от простого менеджера окон до полнофункционального
      набора приложений для рабочего стола.  В Коллекции Портов в категории
      <filename>x11-wm</filename> доступно более сотни таких оболочек.</para>

    <sect2 xml:id="x11-wm-gnome">
      <title>GNOME</title>

      <indexterm><primary>GNOME</primary></indexterm>

      <para><application>GNOME</application> является графической оболочкой с
        дружественным пользовательским интерфейсом.  В ней имеется панель для
        запуска приложений и отображения состояния, рабочий стол, набор
        инструментов и приложений, а также набор соглашений, облегчающих
        совместную работу и взаимную согласованность приложений.
        Дополнительную информацию относительно <application>GNOME</application>
        во &os; можно найти на сайте <link
        xlink:href="http://www.FreeBSD.org/gnome">http://www.FreeBSD.org/gnome</link>.
        Этот сайт содержит дополнительную документацию по установке, настройке
        и управлении <application>GNOME</application> во &os;.</para>

      <para>Эту графическую оболочку можно установить из пакета:</para>

      <screen>&prompt.root; <userinput>pkg install gnome2</userinput></screen>

      <para>Вместо этого можно построить <application>GNOME</application> из
	портов при помощи команды ниже.  <application>GNOME</application>
	является большим приложением, его компиляция займёт определённое время
        даже на быстром компьютере.</para>

      <screen>&prompt.root; <userinput>cd /usr/ports/x11/gnome2</userinput>
&prompt.root; <userinput>make install clean</userinput></screen>

      <para>Для полноценной работы <application>GNOME</application> требует
        наличия смонтированной файловой системы <filename>/proc</filename>.
        Добавьте следующую строку в <filename>/etc/fstab</filename> для
        автоматического монтирования этой файловой системы при запуске
        системы:</para>

      <programlisting>proc           /proc       procfs  rw  0   0</programlisting>

      <para>После установки <application>GNOME</application> настройте
        <application>&xorg;</application> на запуск
        <application>GNOME</application>.  Самый простой способ сделать это
        заключается в активации Менеджера дисплеев GNOME, 
        <application>GDM</application>, который устанавливается в составе
        пакета или порта <application>GNOME</application>.  Его можно
        активировать, добавив следующую строку в
        <filename>/etc/rc.conf</filename>:</para>

      <programlisting>gdm_enable="YES"</programlisting>

      <para>Зачастую желательно также запустить все сервисы
        <application>GNOME</application>.  Для этого добавьте вторую строку
        в <filename>/etc/rc.conf</filename>:</para>

      <programlisting>gnome_enable="YES"</programlisting>

      <para><application>GDM</application> теперь запустится автоматически при
        загрузке системы.</para>

      <para>Вторым способом запуска <application>GNOME</application> является
        набор команды <command>startx</command> в командной строке после
        настройки <filename>~/.xinitrc</filename>.  Если указанный файл уже
        существует, то замените строку, в которой запускается используемый
        менеджер окон, на ту, что вызовет
        <filename>/usr/local/bin/gnome-session</filename>.  Если такой файл
        отсутствует, создайте его следующей командой:</para>

      <screen>&prompt.user; <userinput>echo "/usr/local/bin/gnome-session" &gt; ~/.xinitrc</userinput></screen>

      <para>Третий метод заключается в использовании
        <application>XDM</application> в качестве менеджера дисплеев.  В этом
        случае создайте выполнимый файл
        <filename>~/.xsession</filename>:</para>

      <screen>&prompt.user; <userinput>echo "#!/bin/sh" &gt; ~/.xsession</userinput>
&prompt.user; <userinput>echo "/usr/local/bin/gnome-session" &gt;&gt; ~/.xsession</userinput>
&prompt.user; <userinput>chmod +x ~/.xsession</userinput></screen>

    </sect2>

    <sect2 xml:id="x11-wm-kde">
      <title>KDE</title>

      <indexterm><primary>KDE</primary></indexterm>

      <para><application>KDE</application> является ещё одной простой в
        использовании графической оболочкой.  В неё включен набор приложений с
        общим визуальным и пользовательским подходом, стандартное меню и
        панели инструментов, короткие комбинации клавиш, цветовые схемы,
        интернационализация и централизованное управление настройками рабочего
        стола в диалоговом режиме.  Дополнительную информацию о
	<application>KDE</application> можно найти на сайте <link
        xlink:href="http://www.kde.org/">http://www.kde.org/</link>.
        Поищите информацию, специфичную для &os;, на сайте <link
        xlink:href="http://freebsd.kde.org/">http://freebsd.kde.org</link>.</para>

      <para>Для установки пакета <application>KDE</application>
	наберите:</para>

      <screen>&prompt.root; <userinput>pkg install x11/kde4</userinput></screen>

      <para>Вместо этого можно построить <application>KDE</application> как
        порт при помощи команды ниже.  Процедура установки предусматривает меню
        для выбора компонентов для установки.  <application>KDE</application>
	является больим приложением, для его компиляции потребуется
        определённое время даже на быстром компьютере.</para>

      <screen>&prompt.root; <userinput>cd /usr/ports/x11/kde4</userinput>
&prompt.root; <userinput>make install clean</userinput></screen>

      <indexterm>
        <primary>KDE</primary>
        <secondary>display manager</secondary>
      </indexterm>

      <para><application>KDE</application> требует наличия смонтированной
        файловой системы <filename>/proc</filename>.  Добавьте вот такую строку
        в <filename>/etc/fstab</filename> для автоматического монтирования этой
        файловой системы при запуске:</para>

      <programlisting>proc           /proc       procfs  rw  0   0</programlisting>

      <para>В установочный набор <application>KDE</application> входит
        Менеджер Дисплееы KDE (KDE Display Manager),
        <application>KDM</application>.  Для его активации добавьте следующую
        строку в <filename>/etc/rc.conf</filename>:</para>

      <programlisting>kdm4_enable="YES"</programlisting>

      <para>Другим способом запуска <application>KDE</application> является
        ввод команды <command>startx</command> из командной строки.  Чтобы это
        работало, в файле <filename>~/.xinitrc</filename> должна быть следующая
        строка:</para>

      <programlisting>exec /usr/local/kde4/bin/startkde</programlisting>

      <para>Третьим способом запуска <application>KDE</application> является
        использование <application>XDM</application>.  Чтобы это сделать,
        создайте выполнимый файл <filename>~/.xsession</filename> следующим
        образом:</para>

      <screen>&prompt.user; <userinput>echo "#!/bin/sh" &gt; ~/.xsession</userinput>
&prompt.user; <userinput>echo "/usr/local/kde4/bin/startkde" &gt;&gt; ~/.xsession</userinput>
&prompt.user; <userinput>chmod +x ~/.xsession</userinput></screen>

      <para>После запуска <application>KDE</application> дополнительную
        информацию о порядке использования её различных меню и приложений
        можно найти во встроенной системе помощи.</para>
    </sect2>

    <sect2 xml:id="x11-wm-xfce">
      <title>XFce</title>

	<para><application>XFce</application> является графической оболочкой,
	  построенной на основе инструментального пакета GTK+, используемого в
	  <application>GNOME</application>, но она гораздо легче и предназначена
	  для тех, кому нужен простой, эффективно работающий рабочий стол,
	  который легко использовать и настраивать.  Визуально он выглядит
	  очень похоже на <application>CDE</application>, который есть в
	  коммерческих &unix;-системах.  Вот некоторые из достоинств
	  <application>XFce</application>:</para>

	<itemizedlist>
	  <listitem>
	    <para>Простой, лёгкий в обращении рабочий стол</para>
	  </listitem>

	  <listitem>
	    <para>Полностью настраиваемый при помощи мыши, с
	      интерфейсом drag and drop и так далее</para>
	  </listitem>

	  <listitem>
	    <para>Главная панель похожа на <application>CDE</application>, с
	      меню, апплетами и возможностями по быстрому запуску
	      приложений</para>
	  </listitem>

	  <listitem>
	    <para>Интегрированный оконный менеджер, менеджер файлов,
	      управление звуком, модуль совместимости с
	      <application>GNOME</application> и прочее</para>
	  </listitem>

	  <listitem>
	    <para>Возможность использования тем (так как использует
	      GTK+)</para>
	  </listitem>

	  <listitem>
	    <para>Быстрый, легкий и эффективный: идеален для
	      устаревших/слабых машин или для машин с ограниченной
	      памятью</para>
	  </listitem>
	</itemizedlist>

	<para>Дополнительную информацию о <application>XFce</application>
	  можно найти на <link xlink:href="http://www.xfce.org/">сайте
	  XFce</link>.</para>

	<para>Для установки <application>Xfce</application> наберите:</para>

        <screen>&prompt.root; <userinput>pkg install xfce</userinput></screen>

	<para>Либо, в случае построения из исходного кода, используйте
	  Коллекцию Портов:</para>

	<screen>&prompt.root; <userinput>cd /usr/ports/x11-wm/xfce4</userinput>
&prompt.root; <userinput>make install clean</userinput></screen>

	<para>Теперь укажите X-серверу на запуск
	  <application>XFce</application> при следующем
	  запуске X.  Просто наберите:</para>

	<screen>&prompt.user; <userinput>echo "/usr/local/bin/startxfce4" &gt; ~/.xinitrc</userinput></screen>

	<para>При следующем запуске X в качестве рабочего стола
	  будет использоваться <application>XFce</application>.
	  Как сказано выше, если используется
	  менеджер дисплеев, такой, как <filename>XDM</filename>, создайте
	  файл <filename>.xsession</filename> так, как это
	  описано в разделе <xref linkend="x11-wm-gnome"/>, но
	  с <filename>/usr/local/bin/startxfce4</filename>.</para>
    </sect2>
  </sect1>

  <sect1 xml:id="x11-understanding">
    <title>Устранение неполадок</title>

    <para>Если мышь не работает, то для продолжения работы её необходимо
      настроить.  Обратитесь к разделу <xref linkend="mouse"/> в главе об
      установке &os;.  В последних версиях <application>Xorg</application>
      секции <literal>InputDevice</literal> в файле
      <filename>xorg.conf</filename> игнорируются в пользу автоматического
      обнаружения устройств.  Для того, чтобы вернуть старое поведение,
      добавьте следующую строку в секции <literal>ServerLayout</literal>
      или <literal>ServerFlags</literal> этого файла:</para>

    <programlisting>Option "AutoAddDevices" "false"</programlisting>

    <para>После этого устройства ввода могут быть настроены так же, как в
      предыдущих версиях, вместе с другими необходимыми параметрами
      (например, определяющими переключение раскладок клавиатуры).</para>

    <note>
      <para>Как было объяснено выше, по-умолчанию даемон
        <application>hald</application> будет пытаться распознать
        вашу клавиатуру автоматически. Есть вероятность, что раскладка вашей
        клавиатуры или её модель будут определены некорректно. Такие оболочки,
        как <application>GNOME</application>, <application>KDE</application>
        или <application>Xfce</application>, содержат собственные инструменты
        для настройки клавиатуры.  Тем не менее, можно задать параметры
        клавиатуры явным образом с помощью утилиты &man.setxkbmap.1; или через
        правило настройки <application>hald</application>.</para>

      <para>Например, если требуется использовать клавиатуру стандарта PC 102 с
        французской раскладкой, то необходимо создать конфигурационный файл
        клавиатуры для <application>hald</application> под названием
        <filename>x11-input.fdi</filename> и сохранить его в каталоге
        <filename>/usr/local/etc/hal/fdi/policy</filename>. Этот файл должен
        содержать следующие строки:</para>

      <programlisting>&lt;?xml version="1.0" encoding="iso-8859-1"?&gt;
&lt;deviceinfo version="0.2"&gt;
  &lt;device&gt;
    &lt;match key="info.capabilities" contains="input.keyboard"&gt;
         &lt;merge key="input.x11_options.XkbModel" type="string"&gt;pc102&lt;/merge&gt;
         &lt;merge key="input.x11_options.XkbLayout" type="string"&gt;fr&lt;/merge&gt;
    &lt;/match&gt;
  &lt;/device&gt;
&lt;/deviceinfo&gt;</programlisting>

      <para>Если этот файл уже существует, просто скопируйте и добавьте в ваш
        файл строки, относящиеся к настройке клавиатуры.</para>

      <para>Вы должны будете перезагрузить систему, чтобы заставить
        <application>hald</application> применить настройки.</para>

      <para>Есть возможность выполнить эту же самую настройку из X терминала
        или скрипта следующей командой:</para>

      <screen>&prompt.user; <userinput>setxkbmap -model pc102 -layout fr</userinput></screen>

      <para>В файле
        <filename>/usr/local/share/X11/xkb/rules/base.lst</filename>
        перечислены различные клавиатуры, доступные раскладки и опции.</para>
    </note>

    <indexterm><primary>тонкая настройка <application>&xorg;</application></primary></indexterm>

    <para>Теперь конфигурационный файл <filename>xorg.conf.new</filename>
      может быть тонко настроен на ваш вкус.  Откройте этот файл в текстовом
      редакторе, таком, как &man.emacs.1; или &man.ee.1;.  Если модель
      монитора устарела или является нестандартной и не поддерживает
      автоматическое определение частот развёртки, то эти параметры могут
      быть добавлены в раздел <literal>"Monitor"</literal> файла
      <filename>xorg.conf.new</filename>:</para>

    <programlisting>Section "Monitor"
       Identifier   "Monitor0"
       VendorName   "Monitor Vendor"
       ModelName    "Monitor Model"
       HorizSync    30-107
       VertRefresh  48-120
EndSection</programlisting>

    <para>Большинство мониторов поддерживают автоопределение частоты
      развёртки, что делает ручной ввод этих значений ненужным.  Для
      незначительного количества мониторов, не поддерживающих автоматическое
      определение, следует избегать потенциальной поломки и указывать только
      значения, предоставленные производителем.</para>

    <para>X позволяет использовать возможности технологии DPMS (Energy Star)
      с поддерживающими её мониторами.  Программа &man.xset.1; управляет
      временными задержками и может явно задавать режимы ожидания, останова
      и выключения.  Если вы хотите включить использование возможностей
      DPMS вашего монитора, вы должны добавить следующую строку в раздел,
      описывающий монитор:</para>

    <programlisting>Option       "DPMS"</programlisting>

    <indexterm><primary><filename>xorg.conf</filename></primary></indexterm>

    <para>Пока файл конфигурации <filename>xorg.conf.new</filename> открыт
      в редакторе, выберите желаемые разрешение и глубину цвета, которые
      будут использоваться по умолчанию.  Они задаются в разделе
      <literal>"Screen"</literal>:</para>

    <programlisting>Section "Screen"
       Identifier "Screen0"
       Device     "Card0"
       Monitor    "Monitor0"
       DefaultDepth 24
       SubSection "Display"
               Viewport  0 0
               Depth     24
               Modes     "1024x768"
       EndSubSection
EndSection</programlisting>

    <para>Ключевое слово <literal>DefaultDepth</literal> описывает
      глубину цвета, которая будет применяться по умолчанию.  Это значение
      может быть переопределено при помощи параметра командной строки
      <option>-depth</option> для &man.Xorg.1;.  Ключевое слово
      <literal>Modes</literal> описывает разрешение, с которым нужно
      работать при данной глубине цвета.  Заметьте, что поддерживаются
      только те стандартные режимы VESA, что определены графическим
      оборудованием настраиваемой системы.  В примере выше глубина цвета по
      умолчанию равна двадцати четырём битам на точку.  При такой глубине
      цвета принимается разрешение в 1024 на 768 точек.</para>

    <para>Наконец, запишите конфигурационный файл и протестируйте его при
      помощи тестового режима, описанного выше.</para>

    <note>
      <para>В процессе решения проблем вам могут помочь файлы протоколирования
        <application>&xorg;</application>, в которых находится информация о
        каждом устройстве, к которому подключается сервер
        <application>&xorg;</application>.  Протокольным файлам
        <application>&xorg;</application> названия даются в формате
        <filename>/var/log/Xorg.0.log</filename>.  Конкретное название файла
        протокола может варьироваться от <filename>Xorg.0.log</filename> до
        <filename>Xorg.8.log</filename> и далее.</para>
    </note>

    <para>Если всё в порядке, то конфигурационный файл нужно установить в
      обычное место, где его сможет найти &man.Xorg.1;.  Как правило, это
      <filename>/etc/X11/xorg.conf</filename> или
      <filename>/usr/local/etc/X11/xorg.conf</filename>.</para>

    <screen>&prompt.root; <userinput>cp xorg.conf.new /etc/X11/xorg.conf</userinput></screen>

    <para>Теперь процесс настройки <application>&xorg;</application> завершён.
      <application>&xorg;</application> теперь можно запустить утилитой
      &man.startx.1;.  Сервер <application>&xorg;</application> может быть
      также запущен при помощи &man.xdm.1;.</para>

    <sect2>
      <title>Конфигурирование при работе с графическими чипсетами &intel;
        <literal>i810</literal></title>

      <indexterm><primary>графический чипсет Intel i810</primary></indexterm>

      <para>Конфигурирование при работе с интегрированными наборами микросхем
        &intel; i810 требует наличия <filename>agpgart</filename>,
        программного интерфейса AGP, посредством которого
        <application>&xorg;</application> будет управлять адаптером.
        Подробности смотрите на странице справочника &man.agp.4;.</para>

      <para>Это позволит конфигурировать графическое оборудование точно так
        же, как и любой другой графический адаптер.  Заметьте, что для
        систем, у которых драйвер &man.agp.4; в ядро не вкомпилирован,
        попытка загрузить модуль с помощью &man.kldload.8; не сработает.
        Этот драйвер должен быть в ядре во время загрузки, либо
        вкомпилированным, либо подгруженным посредством
        <filename>/boot/loader.conf</filename>.</para>
    </sect2>

    <sect2>
      <title>Добавление широкоэкранной панели</title>

      <indexterm><primary>настройка широкоэкранной панели</primary></indexterm>

      <para>Этот раздел предполагает наличие определённых глубоких познаний в
        настройке.  Если попытки применить описанные выше инструменты настройки
        к созданию рабочей конфигурации не приводят, в файлах протоколов
        достаточно информации для доведения конфигурации до рабочего состояния.
        Для настройки необходимо использовать текстовый редактор.</para>

      <para>Существующие широкоэкранные стандарты (WSXGA, WSXGA+, WUXGA, WXGA,
        WXGA+ и так далее) поддерживают форматы изображения 16:10 и 10:9,
        которые могут быть проблемными.  Для формата 16:10, например, возможны
        следующие разрешения экрана:</para>

      <itemizedlist>
        <listitem>
          <para>2560x1600</para>
        </listitem>

        <listitem>
          <para>1920x1200</para>
        </listitem>

        <listitem>
          <para>1680x1050</para>
        </listitem>

        <listitem>
          <para>1440x900</para>
        </listitem>

        <listitem>
          <para>1280x800</para>
        </listitem>
      </itemizedlist>

      <para>Это так же легко, как добавить одно из этих
        разрешений в качестве доступного режима (<literal>Mode</literal>) в
        раздел <literal>Section "Screen"</literal> следующим образом:</para>

      <programlisting>Section "Screen"
Identifier "Screen0"
Device     "Card0"
Monitor    "Monitor0"
DefaultDepth 24
SubSection "Display"
       Viewport  0 0
       Depth     24
       Modes     "1680x1050"
EndSubSection
EndSection</programlisting>

      <para><application>&xorg;</application> достаточно умён, чтобы получить
        информацию о разрешении от монитора посредством I2C/DDC, так что у него
        есть данные, какие частоты и разрешения может поддерживать
        монитор.</para>

      <para>Если эти <literal>ModeLine</literal> не определены в драйверах,
        может потребоваться дополнительная настройка
        <application>&xorg;</application>.  Используя
        <filename>/var/log/Xorg.0.log</filename>, можно извлечь достаточно
        информации для создания работающей строки <literal>ModeLine</literal> в
        ручном режиме.  Просто поищите информацию, похожую на такую:</para>

      <programlisting>(II) MGA(0): Supported additional Video Mode:
(II) MGA(0): clock: 146.2 MHz   Image Size:  433 x 271 mm
(II) MGA(0): h_active: 1680  h_sync: 1784  h_sync_end 1960 h_blank_end 2240 h_border: 0
(II) MGA(0): v_active: 1050  v_sync: 1053  v_sync_end 1059 v_blanking: 1089 v_border: 0
(II) MGA(0): Ranges: V min: 48  V max: 85 Hz, H min: 30  H max: 94 kHz, PixClock max 170 MHz</programlisting>

      <para>Это так называемая информация EDID.  Создание
        <literal>ModeLine</literal> из этих данных является вопросом
        расположения значений в правильном порядке:</para>

      <programlisting>ModeLine &lt;name&gt; &lt;clock&gt; &lt;4 horiz. timings&gt; &lt;4 vert. timings&gt;</programlisting>

      <para>Таким образом, для данного примера <literal>ModeLine</literal> в
        разделе <literal>Section "Monitor"</literal> будет выглядеть примерно
        так:</para>

      <programlisting>Section "Monitor"
Identifier      "Monitor1"
VendorName      "Bigname"
ModelName       "BestModel"
ModeLine        "1680x1050" 146.2 1680 1784 1960 2240 1050 1053 1059 1089
Option          "DPMS"
EndSection</programlisting>

      <para>После завершения этих простых шагов по редактированию настроек X
        должны запуститься на вашем новом широкоэкранном мониторе.</para>
    </sect2>
  </sect1>
</chapter>
